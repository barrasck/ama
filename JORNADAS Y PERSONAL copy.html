<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMA LOGISTIC - Inicio de Sesión</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <style>
        /* Estilos para la página de ingreso */
        body.login-page {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .login-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0px 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 400px;
            width: 90%;
            animation: fadeIn 1s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .login-container h1 {
            color: #004085;
            font-size: 28px;
            margin-bottom: 20px;
            font-weight: 600;
        }
        .login-container p {
            font-size: 14px;
            color: #555;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        .login-container input {
            width: 94%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        .login-container input:focus {
            border-color: #004085;
            outline: none;
        }
        .login-container button {
            background: #004085;
            color: white;
            font-weight: bold;
            border: none;
            cursor: pointer;
            padding: 12px;
            width: 100%;
            margin-top: 20px;
            border-radius: 8px;
            transition: background 0.3s ease;
            font-size: 16px;
        }
        .login-container button:hover {
            background: #003366;
        }
        .login-container .logo {
            width: 100px;
            margin-bottom: 20px;
        }
        .login-container .footer {
            margin-top: 20px;
            font-size: 12px;
            color: #777;
        }
        .login-container .footer a {
            color: #004085;
            text-decoration: none;
            font-weight: 500;
        }
        .login-container .footer a:hover {
            text-decoration: underline;
        }

        /* Estilos para la parte interna */
        body.internal-page {
            font-family: 'Lato', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
            color: #333;
        }
        /* Estilos para la barra de usuario y logo */
        .navbar {
            background: #004085;
            padding: 0px 9px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            font-size: 18px;
            font-weight: bold;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.2);
            height: 50px;
        }

        /* Contenedor para el usuario activo y el botón */
        .navbar-left {
            display: flex;
            align-items: center;
            gap: 10px;
        margin-left: -10px; /* Añadir margen izquierdo para moverlo hacia la izquierda */
        }

.usuario-actual {
    font-size: 14px;
    font-weight: normal;
    position: relative;
    margin-top: -10px; /* Corregido: margin-TOP -> margin-top */
    top: 1px;
}

.container button {
    font-weight: bold;
    border: none;
    cursor: pointer;
    padding: 12px;
    border-radius: 8px;
    transition: background 0.3s ease;
}

        /* Estilos para el botón de cerrar sesión */
        .btn-cerrar-sesion {
            background: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
            margin-right: 25px;
            position: relative;
            top: -4px;
        }

        .btn-cerrar-sesion:hover {
            background: #c82333;
        }


    .btn-mas-informacion {
        background: #007bff;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.3s ease;
    }

    .btn-mas-informacion:hover {
        background: #0056b3;
    }


    /* Estilo para el botón de Registrar Trabajador */
    .btn-registrar-trabajador {
        background: #28a745; /* Color verde */
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 10px;
            width: 97%;
        }

    .btn-registrar-trabajador:hover {
        background: #218838; /* Color verde oscuro al pasar el mouse */
    }


    .btn-X {
    position: fixed; /* Fijar el botón en la pantalla */
    right: 290px; /* Distancia desde la derecha */
    background: #FFFFFF; /* Color blanco */
    color: gray;
    border: none;
    padding: 10px;
    cursor: pointer;
    border-radius: 5px;
    width: auto; /* Ajusta automáticamente el tamaño según el texto */
    z-index: 1000; /* Para que esté sobre otros elementos */
}    
.btn-X:hover {
        background: #FFFFFF; /* blanco */
    }

        /* Estilos para la barra de pestañas */
        .tabs {
            display: flex;
            justify-content: flex-start;
            background: #0056b3;
            padding: 2px;
            position: fixed;
            top: 47px; /* Ajusta la posición debajo de la barra de navegación */
            left: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.2);
            height: 30px;
        }

        .tabs button {
            background: transparent;
            border: none;
            color: white;
            font-size: 14px;
            cursor: pointer;
            padding: 0px 20px;
            font-weight: bold;
            transition: background 0.3s ease;
		width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            margin: 0;
            border-right: 1px solid rgba(255, 255, 255, 0.2);
        }

        .tabs button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .tabs button:last-child {
            border-right: none;
        }

        /* Estilos para el contenedor principal */
        .container {
            max-width: 1200px;
            margin: 100px auto 40px;
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
        }

.table-container {
  padding: 0 1rem;
}



        .container input, .container select {
            width: 97%;
            padding: 8px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
        }

        h2 {
            text-align: center;
            color: #004085;
            margin-top: 0px;
            margin-bottom: 20px;
        }
  h3 {
            text-align: center;
            color: #004085;
            Margin-top: 0px;
            margin-bottom: 5px;
        }

        h4 {
            text-align: center;
		font-size: 24px;
            color: #004085;
            margin-top: 5px;
            margin-bottom: 0px;
        }
        h5 {
            text-align: center;
            color: #004085;
            font-size: 19px; 
            margin-top: 0px;
            margin-bottom: 20px;
        }
        h6 {
            text-align: center;
            color: #004085;
            font-size: 19px; 
            margin-top: 0px;
            margin-bottom: 20px;
	
        }



.modal-contenido h6 {
    width: 100%; /* Ocupa todo el ancho */
    margin: 0; /* Elimina márgenes */
    padding: 10px; /* Añade padding */
    box-sizing: border-box; /* Incluye el padding en el ancho */
    text-align: center; /* Centra el texto horizontalmente */

}


/* Aumentar el tamaño del textarea */
textarea {
    height: 100px; /* Altura fija */
    width: 100%;
    resize: vertical; /* Permite redimensionar verticalmente */
}
        label {
            font-weight: bold;
            display: flex-box;
            margin-top: 15px;

        }

        input, select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }

        button {
    color: white;
    font-weight: bold;
    border: none;
    cursor: pointer;
    padding: 12px;
    border-radius: 8px;
    transition: background 0.3s ease;
   text-align: center;
            background: #004085;
            Gap: 5px;
	    margin-left: 10px;
        }
        button:hover {
            background: #003366;
        }

        table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 12px;
            text-align: left;
    font-size: 12px;
        }

        th {
            background: #004085;
            color: white;
            text-align: center;

        }

 /* Ancho de las columnas */
        table th:nth-child(1), table td:nth-child(1) {
            width: 1%; /* Ancho de la primera columna */
        }

        table th:nth-child(2), table td:nth-child(2) {
            width: 15%; /* Ancho de la primera columna */
        }

        table th:nth-child(3), table td:nth-child(2) {
            width: 1%; /* Ancho de la segunda columna */
        }

        table th:nth-child(4), table td:nth-child(3) {
            width: 1%; /* Ancho de la tercera columna */
        }

        table th:nth-child(5), table td:nth-child(4) {
            width: 1%; /* Ancho de la cuarta columna */
        }

        table th:nth-child(6), table td:nth-child(5) {
            width: 4%; /* Ancho de la quinta columna */
        }

        .exceso-horas {
            background-color: #ffcccc !important;
            font-weight: bold;
            color: red;
        }

        .total {
            font-weight: bold;
            text-align: right;
            margin-top: 15px;
            font-size: 18px;
            color: #007bff;
        }

/* Evitar que los botones de acciones hereden estilos generales */
.container button {
    font-weight: bold;
    border: none;
    cursor: pointer;
    padding: 12px;
    border-radius: 8px;
    transition: background 0.3s ease;
   text-align: center;
}

/* Excluir los botones de editar y eliminar */
.acciones button {
    width: auto;  /* Permitir que los botones ajusten su tamaño */
    padding: 5px 10px;
    font-size: 8px;
    border-radius: 4px;
}


/* Estilos para la celda de acciones */
td.acciones {
    display: flex; /* Usar flexbox para alinear los botones horizontalmente */
    gap: 5px; /* Espacio entre los botones */
    justify-content: center; /* Centrar los botones horizontalmente */
    align-items: center; /* Centrar los botones verticalmente */
    padding: 5px; /* Espacio interno en la celda */

}


/* Estilos para los botones de editar y eliminar */
.btn-editar, .btn-eliminar {
    padding: 6px 12px; /* Reducir el padding para hacerlos más pequeños */
    font-size: 12px; /* Reducir el tamaño de la fuente */
    border-radius: 20px; /* Bordes redondeados */
    cursor: pointer;
    transition: background 0.3s ease;
    margin: 0 4px;
    border: none; /* Eliminar el borde */
}

/* Estilo específico para el botón de editar */
.btn-editar {
    background: #ffc107; /* Color amarillo */
    color: black;
}

.btn-editar:hover {
    background: #e0a800; /* Color amarillo oscuro al pasar el mouse */
}

/* Estilo específico para el botón de eliminar */
.btn-eliminar {
    background: #dc3545; /* Color rojo */
    color: white;
}

.btn-eliminar:hover {
    background: #c82333; /* Color rojo oscuro al pasar el mouse */

}        

/* Ajustar el ancho de la columna de acciones */
table th:nth-child(5),
table td:nth-child(5) {
    text-align: center; /* Centrar el contenido de la columna */
}
        /* Estilos para el modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

/* Estilo para el modal de más información */
.modal-contenido {
    display: flex;
    flex-direction: column;
    padding: 20px;
    border-radius: 8px;
    background: white;
    max-width: 860px;
    max-height: 67vh;
    overflow-y: auto;
WIDTH: 100%;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr); /* 3 columnas del mismo tamaño */
    gap: 15px; /* Espacio entre las columnas */
    width: 100%;
    padding: 10px;
}

.form-group {
    display: flex;
    flex-direction: column;
    width: 100%; /* Asegura que ocupe toda la columna */
}

.form-group span {
    display: block; /* Hace que los datos ocupen la fila correctamente */
    min-height: 10px; /* Para que no sean invisibles */
    background: #f8f9fa; /* Fondo similar al input */
    padding: 5px; /* Espaciado interno */
    border-radius: 5px;
    border: 1px solid #ccc; /* Simula un input */
}


.form-group {
    display: flex;
    flex-direction: column;
    margin-bottom: 10px;
}

label {
    font-weight: bold;
    margin-bottom: 5px;
}
.modal-contenido .form-group {
    margin: 0; /* Eliminar margen para un mejor alineamiento */
}

/* Estilo para la foto del trabajador en el modal */
#fotoTrabajadorDetalle {
    max-width: 150px; /* Tamaño máximo de la foto */
    border-radius: 50%; /* Forma circular */
    border: 2px solid #004085; /* Borde */
    margin-bottom: 10px; /* Espacio inferior */
}


    /* Estilos para los campos del formulario */
    .modal-contenido input,
    .modal-contenido select {
        width: 90%;
        padding: 8px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 14px;
    }

/* Estilos para los checkboxes */
input[type="checkbox"] {
    transform: scale(0.8); /* Reducir el tamaño del checkbox */
    margin-right: 5px; /* Espacio entre el checkbox y la etiqueta */
WIDTH: auto;
}

/* Estilos para las etiquetas de los checkboxes */
label-opcion1 {
    font-size: 12px; /* Tamaño de fuente más pequeño */
    margin-right: 10px; /* Espacio entre las etiquetas */
DISPLAY: block;
}

/* Estilos para los checkboxes dentro de los grupos de capacitaciones y documentos */
.form-group.full-width label {
    font-size: 12px; /* Tamaño de fuente más pequeño */
    color: #333; /* Color del texto */
    display: inline-block; /* Hacer que las etiquetas sean bloques en línea */
    margin-right: 10px; /* Espacio entre las etiquetas */
}

/* Estilos para los checkboxes dentro de los grupos de capacitaciones y documentos */
.form-group.full-width input[type="checkbox"] {
    transform: scale(0.8); /* Reducir el tamaño del checkbox */
    margin-right: 5px; /* Espacio entre el checkbox y la etiqueta */
}

    .modal-contenido label {
        font-weight: bold;
        margin-top: 8px;
        display: block;
    }

/* Estilo para el contenedor del formulario */
.contenedor-formulario {
    position: relative; /* Necesario para el degradado */
    max-height: 400px; /* Altura máxima del contenedor */
    overflow-y: auto; /* Permite desplazamiento vertical */
    padding-bottom: 50px; /* Espacio para el degradado */
}

/* Degradado en la parte inferior */
.contenedor-formulario::after {
    content: ""; /* Necesario para el pseudo-elemento */
    position: absolute; /* Posición absoluta para colocarlo en la parte inferior */
    bottom: 0; /* Lo coloca en la parte inferior */
    left: 0;
    right: 0;
    height: 50px; /* Altura del degradado */
    background: linear-gradient(
        to bottom,
        rgba(255, 255, 255, 0), /* Transparente en la parte superior */
        rgba(255, 255, 255, 1)  /* Blanco en la parte inferior */
    );
    pointer-events: none; /* Permite hacer clic en el contenido debajo */
}

        .modal-cerrar {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 10px;
            width: 97%;
        }

        .modal-cerrar:hover {
            background: #c82333;
        }

        /* Estilos para subsecciones */
        .subseccion {

  display: none;
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;

        }

.subseccion.activa {
  display: block; /* Muestra la subsección activa */
}


/* Estilo para el campo de subida de foto */
input[type="file"] {
    width: 23%;
    padding: 10px;
    margin-top: 5px;
    border: 1px solid #ccc;
    border-radius: 5px;
    background: #f9f9f9;
    font-size: 14px;
    cursor: pointer;
}

/* Cambiar el estilo del botón de selección de archivo */
input[type="file"]::file-selector-button {
    background: #004085;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s ease;
}

input[type="file"]::file-selector-button:hover {
    background: #003366;
}

.form-container {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
    max-width: 1200px;
    width: 100%;
    margin: 20px auto;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
}

.detalles-trabajador {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
}

.photo-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    grid-column: span 3;
    margin-bottom: 20px;
    margin-top: 30px;
}

.photo-section img {
    width: 170px;
    height: 170px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 10px;
    border: 2px solid #ccc;
}

.form-group {
    display: flex;
    flex-direction: column;
    margin-bottom: 10px;
}

label {
    font-weight: bold;
    margin-bottom: 5px;
    font-size: 13px;
}

input, select {
    padding: 6px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 12px;
}

.full-width {
    grid-column: span 3;
}

button:hover {
    background: #0056b3;
}

#formularioColilla {
    margin-top: 20px;
}

#colillaPago {
    margin-top: 20px;
}

#colillaPago table {
    width: 100%;
    margin-top: 20px;
    border-collapse: collapse;
}

#colillaPago th, #colillaPago td {
    border: 1px solid #ccc;
    padding: 12px;
    text-align: left;
}

#colillaPago th {
    background: #004085;
    color: white;
    text-align: center;
}

#colillaPago .total {
    font-weight: bold;
    text-align: right;
    margin-top: 15px;
    font-size: 18px;
    color: #007bff;
}

.estado-pendiente {
    color: red;
    font-weight: bold;
}

.estado-completo {
    color: green;
    font-weight: bold;
}

.titulo-centrado {
    text-align: center;
}


.btn-generar-carnet {
    background: #28a745;
    color: white;
    border: none;
    padding: 10px;
    cursor: pointer;
    border-radius: 5px;
    margin-top: 20px;
    width: 100%;
}

.btn-generar-carnet:hover {
    background: #218838;
}

#operacionesChecklist {
    display: flex;
    flex-direction: row;
    gap: 5px;
    flex-wrap: wrap;
    align-content: flex-end;
    justify-content: center;
}

#operacionesChecklist label {
    display: flex;
    align-items: center;
    gap: 5px; /* Espacio entre el checkbox y el texto */
}

.nav-modulos {
    background: #f0f0f0;
    padding: 10px;
    margin-bottom: 20px;
}

.nav-modulos button {
    padding: 8px 15px;
    margin-right: 5px;
    cursor: pointer;
    background: #004085;
    color: white;
    border: none;
    border-radius: 4px;
}

.seccion {
    display: none;
    padding: 20px;
    border: 1px solid #ddd;
    margin-top: 15px;
}

.activo {
    display: block;
}


        .progress-container {
            width: 100%;
            height: 20px;
            background-color: #eee;
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .progress-bar {
            height: 100%;
            background-color: #4CAF50;
            border-radius: 10px;
            transition: width 0.3s ease;
        }
        
        .comparativo-numbers {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .prefacturado { color: #2196F3; }
        .nomina { color: #FF9800; }
    .sub-tabs {
        display: flex;
        gap: 10px;
        margin: 15px 0;
    }
    
    .sub-tabs button {
        padding: 8px 15px;
        background: #004085;
        color: white;
        border: none;
        border-radius: 5px;
    }
    
    .kpi-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
    }
    
    .kpi-box {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        text-align: center;
    }
    
    .kpi-value {
        font-size: 24px;
        font-weight: bold;
        color: #004085;
        margin-top: 10px;
    }
    
    .checklist-item {
        margin: 10px 0;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
    }

.jornadas-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.filtros-compactos {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.filtro-group {
  display: flex;
  gap: 0.5rem;
}

.input-fecha, .select-filtro {
  flex: 1;
  padding: 0.5rem;
  border: 1px solid #ddd;
  border-radius: 6px;
}

.resumen-jornadas {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.resumen-card {
  background: white;
  padding: 1rem;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  text-align: center;
  transition: transform 0.2s ease;
}

.resumen-card.highlight {
  background: #00b148;
  color: white;
}

.tabla-optimizada {
  width: 100%;
  border-collapse: collapse;
  background: white;
  margin: 1rem 0;
  border-radius: 8px;
}

.tabla-optimizada th {
  padding: 15px 20px;
  background: #004085;
  color: white;
  text-align: center;
}

.tabla-optimizada td {
  padding: 12px 20px;
  border-bottom: 1px solid #eee;
}

.text-center { text-align: center; }
.text-right { text-align: right; }

.btn-registrar, .btn-exportar {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  margin-top: 20px;
}

.btn-registrar {
  background: #004085;
  color: white;
}

.btn-exportar {
  background: #28a745;
  color: white;
}

@media (max-width: 768px) {
  .container {
    margin: 10px;
    padding: 1rem !important;
  }
  
  .header-actions {
    flex-direction: column;
    width: 100%;
  }
  
  .header-actions button {
    width: 100%;
    margin: 5px 0;
  }
}

.resumen-card:hover {
  transform: translateY(-3px);
box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}



    </style>
</head>
<body class="login-page">
    <!-- Pantalla de inicio de sesión -->
    <div class="login-container">
<img 
    src="/Users/cristiancuellar/Downloads/LOGO AMA.png" 
    alt="Descripción de la imagen"
    width="300" 
    height="200"
>
        <h1>Bienvenido a AMA LOGISTICS</h1>
        <p>Optimización, Control y Eficiencia en la Gestión Logística</p>
        <input type="text" id="usuario" placeholder="Usuario" required>
        <input type="password" id="contrasena" placeholder="Contraseña" required onkeypress="if(event.key === 'Enter') iniciarSesion()">
        <button onclick="iniciarSesion()">Iniciar Sesión</button>
        <div class="footer">
            © 2023 AMA LOGISTIC. Todos los derechos reservados. | <a href="#">Política de Privacidad</a>
        </div>
    </div>

    <!-- Contenido principal (oculto hasta el inicio de sesión) -->
    <div id="mainContent" style="display: none;">
        <div class="navbar">
            <span>AMA LOGISTIC - Sistema de Gestión</span>
            <div class="navbar-left">
                <span class="usuario-actual">Usuario: <span id="nombreUsuarioActual"></span></span>
                <button class="btn-cerrar-sesion" onclick="cerrarSesion()">Cerrar Sesión</button>
            </div>
        </div>
        <div class="tabs">
            <button onclick="mostrarSeccion('recursosHumanos')">Recursos Humanos</button>
	    <button onclick="mostrarSeccion('hseq')">HSEQ</button>
            <button onclick="mostrarSeccion('operacion')">Operación</button>
            <button onclick="mostrarSeccion('financiera')">Financiera</button>
            <button onclick="mostrarSeccion('informe')">Informe</button>
            <button onclick="mostrarSeccion('personal')">Personal</button>
        </div>

        <!-- Sección de Recursos Humanos -->
        <div id="recursosHumanos" class="container">
            <h4>Recursos Humanos</h4>

            <button onclick="mostrarSubseccion('registro')">Registro de Trabajadores</button>
            <button onclick="mostrarSubseccion('usuarios')">Gestión de Usuarios</button>

            <!-- Subsección de Registro de Trabajadores -->
            <div id="registro" class="subseccion">
                <h3>Registro de Trabajadores</h3>
                <button onclick="abrirModalTrabajador()">Ingresar Nuevo Trabajador</button>
                <h5>Lista de Trabajadores</h5>
                <div class="filtro">
                    <input type="text" id="filtroTrabajadores" placeholder="Buscar por nombre o número de documento" oninput="filtrarTrabajadores()">
                </div>


<table>
    <thead>
        <tr>
            <th>#</th> <!-- Columna para el consecutivo -->
            <th>Nombre y Apellidos</th>
            <th>Tipo de Documento</th>
            <th>Número de Documento</th>
            <th>Más Información</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody id="listaTrabajadores"></tbody>
</table>

<!-- Modal para Mostrar Más Información -->
<div id="modalMasInformacion" class="modal">
    <div class="modal-contenido">

<!-- Botón (X) para cerrar el modal -->
<button onclick="cerrarModalMasInformacion()" class="btn-X">×</button>
        <h2>Hoja de Vida del Trabajador</h2>
                    <div class="full-width">
                        <h4>Datos Básicos</h4>
                    </div>
                <!-- Contenedor para la foto -->
        <div class="photo-section">
            <img id="fotoTrabajadorDetalle" src="" alt="Foto del Trabajador" style="max-width: 150px; border-radius: 50%; display: none;">
        </div>



                <div id="detallesTrabajador" class="form-grid">
            <div class="form-group">

                <label>ID del Trabajador:</label>
                <span id="trabajadorId"></span>
            </div>
            <div class="form-group">
                <label>Nombre y Apellidos:</label>
                <span id="trabajadorNombre"></span>
            </div>
            <div class="form-group">
                <label>Correo Electrónico:</label>
                <span id="trabajadorCorreo"></span>
            </div>
            <div class="form-group">
                <label>Tipo de Documento:</label>
                <span id="trabajadorTipoDocumento"></span>
            </div>
            <div class="form-group">
                <label>Número de Documento:</label>
                <span id="trabajadorNumeroDocumento"></span>
            </div>
            <div class="form-group">
                <label>Fecha de Nacimiento:</label>
                <span id="trabajadorFechaNacimiento"></span>
            </div>
            <div class="form-group">
                <label>RH:</label>
                <span id="trabajadorRh"></span>
            </div>
            <div class="form-group">
                <label>Género:</label>
                <span id="trabajadorGenero"></span>
            </div>
            <div class="form-group">
                <label>Ciudad:</label>
                <span id="trabajadorCiudad"></span>
            </div>
            <div class="form-group">
                <label>Barrio de Residencia:</label>
                <span id="trabajadorBarrio"></span>
            </div>
            <div class="form-group">
                <label>Dirección de Residencia:</label>
                <span id="trabajadorDireccion"></span>
            </div>
            <div class="form-group">
                <label>Teléfono de Contacto:</label>
                <span id="trabajadorTelefonoContacto"></span>
            </div>
            <div class="form-group">
                <label>Teléfono de Emergencia:</label>
                <span id="trabajadorTelefonoEmergencia"></span>
            </div>
            <div class="form-group">
                <label>Estado Civil:</label>
                <span id="trabajadorEstadoCivil"></span>
            </div>
            <div class="form-group">
                <label>Número de Hijos:</label>
                <span id="trabajadorNumeroHijos"></span>
            </div>
            <div class="form-group">
                <label>Edad de los Hijos:</label>
                <span id="trabajadorEdadHijos"></span>
            </div>
            <div class="form-group">
                <label>ARL:</label>
                <span id="trabajadorArl"></span>
            </div>
            <div class="form-group">
                <label>EPS:</label>
                <span id="trabajadorEps"></span>
            </div>
            <div class="form-group">
                <label>Pensión:</label>
                <span id="trabajadorPension"></span>
            </div>
            <div class="form-group">
                <label>Cesantías:</label>
                <span id="trabajadorCesantias"></span>
            </div>
                    <!-- Sección de Estudios -->
                    <div class="full-width">
                        <h4>Información academica</h4>
                    </div>

            <div class="form-group">
                <label>Título Obtenido:</label>
                <span id="trabajadorTituloObtenido"></span>
            </div>
            <div class="form-group">
                <label>Institución:</label>
                <span id="trabajadorInstitucion"></span>
            </div>
            <div class="form-group">
                <label>Ciudad Académica:</label>
                <span id="trabajadorCiudadAcademica"></span>
            </div>
            <div class="form-group">
                <label>Último Grado:</label>
                <span id="trabajadorUltimoGrado"></span>
            </div>
            <div class="form-group">
                <label>Año Culminado:</label>
                <span id="trabajadorAnioCulminado"></span>
            </div>

                    <div class="full-width">
                        <h4>Información laboral</h4>
                    </div>

            <div class="form-group">
                <label>Última Experiencia Laboral:</label>
                <span id="trabajadorUltimaExperiencia"></span>
            </div>
            <div class="form-group">
                <label>Empresa:</label>
                <span id="trabajadorEmpresa"></span>
            </div>
            <div class="form-group">
                <label>Cargo:</label>
                <span id="trabajadorCargo"></span>
            </div>
            <div class="form-group">
                <label>Fecha de Ingreso Laboral:</label>
                <span id="trabajadorFechaIngresoLaboral"></span>
            </div>
            <div class="form-group">
                <label>Fecha de Retiro Laboral:</label>
                <span id="trabajadorFechaRetiroLaboral"></span>
            </div>
            <div class="form-group">
                <label>Teléfono Laboral:</label>
                <span id="trabajadorTelefonoLaboral"></span>
            </div>

                    <div class="full-width">
                        <h4>Acudiente</h4>
                    </div>

            <div class="form-group">
                <label>Parentesco:</label>
                <span id="trabajadorParentesco"></span>
            </div>
            <div class="form-group">
                <label>Nombre del Familiar:</label>
                <span id="trabajadorNombreFamiliar"></span>
            </div>
            <div class="form-group">
                <label>Teléfono del Familiar:</label>
                <span id="trabajadorTelefonoFamiliar"></span>
            </div>

                    <div class="full-width">
                        <h4>Contrato</h4>
                    </div>

            <div class="form-group">
                <label>Modelo de Contrato:</label>
                <span id="trabajadorModeloContrato"></span>
            </div>
            <div class="form-group">
                <label>Capacitaciones Recibidas:</label>
                <span id="trabajadorCapacitacionesRecibidas"></span>
            </div>
            <div class="form-group">
                <label>Documentos Entregados:</label>
                <span id="trabajadorDocumentosEntregados"></span>
            </div>

                    <div class="full-width">
                        <h4>Cuenta bancaria</h4>
                    </div>

            <div class="form-group">
                <label>Tipo de Cuenta:</label>
                <span id="trabajadorTipoCuenta"></span>
            </div>
            <div class="form-group">
                <label>Banco:</label>
                <span id="trabajadorBanco"></span>
            </div>
            <div class="form-group">
                <label>Tipo de Documento del Titular:</label>
                <span id="trabajadorTipoDocumentoTitular"></span>
            </div>
            <div class="form-group">
                <label>Nombre del Titular:</label>
                <span id="trabajadorNombreTitular"></span>
            </div>
            <div class="form-group">
                <label>Número de Documento del Titular:</label>
                <span id="trabajadorNumeroDocumentoTitular"></span>
            </div>
            <div class="form-group">
                <label>Número de Cuenta:</label>
                <span id="trabajadorNumeroCuenta"></span>
            </div>
        </div>
        </form>

        <button onclick="generarCarnet()" class="btn-generar-carnet">Generar Carnet</button>

    </div>
            </div>



            <!-- Subsección de Gestión de Usuarios -->
            <div id="usuarios" class="subseccion">
                <h3>Gestión de Usuarios</h3>
                <button onclick="abrirModalUsuario()">Agregar Nuevo Usuario</button>
                <h2>Lista de Usuarios</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Usuario</th>
                            <th>Acceso a Registro de Trabajadores</th>
                            <th>Acceso a Registro de Jornadas</th>
                            <th>Acceso a Tarifas</th>
                            <th>Acceso a Sedes</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaUsuarios"></tbody>
                </table>
            </div>

<button onclick="exportarTrabajadoresExcel()" class="btn-exportar">
    <i class="fas fa-file-excel"></i> Exportar Trabajadores
</button>
            </div>


</div>



<!-- Sección HSEQ -->
<div id="hseq" class="container">
    <h4>Gestión HSEQ</h4>
    
    <!-- Subtabs para módulos HSEQ -->
    <div class="sub-tabs">
        <button onclick="mostrarSubseccionHSEQ('incidentes')">Incidentes/Accidentes</button>
        <button onclick="mostrarSubseccionHSEQ('capacitaciones')">Capacitaciones</button>
        <button onclick="mostrarSubseccionHSEQ('epp')">Control EPP</button>
        <button onclick="mostrarSubseccionHSEQ('checklist')">Checklist</button>
        <button onclick="mostrarSubseccionHSEQ('riesgos')">Matriz de Riesgos</button>
    </div>

    <!-- Subsección Incidentes/Accidentes -->
    <div id="incidentes" class="subseccion">
        <h3>Registro de Incidentes/Accidentes</h3>
        <button onclick="abrirModalIncidente()">Nuevo Registro</button>
        <table>
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Tipo</th>
                    <th>Descripción</th>
                    <th>Gravedad</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="listaIncidentes"></tbody>
        </table>
    </div>

    <!-- Subsección Capacitaciones -->
    <div id="capacitaciones" class="subseccion">
        <h3>Evidencias de Capacitaciones</h3>
        <input type="file" id="evidenciaCapacitacion" multiple accept="image/*, .pdf">
        <table>
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Tema</th>
                    <th>Archivos</th>
                    <th>Asistentes</th>
                </tr>
            </thead>
            <tbody id="listaCapacitaciones"></tbody>
        </table>
    </div>

    <!-- Subsección EPP -->
    <div id="epp" class="subseccion">
        <h3>Control de Dotación y EPP</h3>
        <button onclick="abrirModalEPP()">Asignar EPP</button>
        <table>
            <thead>
                <tr>
                    <th>Trabajador</th>
                    <th>Equipo</th>
                    <th>Fecha Entrega</th>
                    <th>Vencimiento</th>
                    <th>Estado</th>
                </tr>
            </thead>
            <tbody id="listaEPP"></tbody>
        </table>
    </div>

    <!-- Subsección Checklist -->
    <div id="checklist" class="subseccion">
        <h3>Checklist de Inspecciones</h3>
        <div id="checklistContainer"></div>
        <button onclick="guardarChecklist()">Guardar Inspección</button>
    </div>

    <!-- Subsección Matriz de Riesgos -->
    <div id="riesgos" class="subseccion">
        <h3>Matriz de Riesgos</h3>
        <button onclick="actualizarMatriz()">Actualizar Matriz</button>
        <div id="matrizRiesgos"></div>
    </div>

    <!-- Panel de Control KPI -->
    <div class="subseccion">
        <h3>Panel de Control</h3>
        <div class="kpi-container">
            <div class="kpi-box">
                <h4>Tasa de Incidentes</h4>
                <div class="kpi-value" id="tasaIncidentes">0%</div>
            </div>
            <div class="kpi-box">
                <h4>Cumplimiento EPP</h4>
                <div class="kpi-value" id="cumplimientoEPP">0%</div>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Incidentes -->
<div id="modalIncidente" class="modal">
    <div class="modal-contenido">
        <button class="btn-X" onclick="cerrarModalIncidente()">×</button>
        <h3>Registro de Incidente</h3>
        <form id="formIncidente">
            <input type="date" id="fechaIncidente" required>
            <select id="tipoIncidente" required>
                <option value="Accidente">Accidente</option>
                <option value="Incidente">Incidente</option>
                <option value="Casi Accidente">Casi Accidente</option>
            </select>
            <textarea id="descripcionIncidente" placeholder="Descripción" required></textarea>
            <select id="gravedadIncidente" required>
                <option value="Leve">Leve</option>
                <option value="Moderado">Moderado</option>
                <option value="Grave">Grave</option>
            </select>
            <button type="submit">Guardar</button>
        </form>
    </div>
</div>

<!-- Modal para EPP -->
<div id="modalEPP" class="modal">
    <div class="modal-contenido">
        <button class="btn-X" onclick="cerrarModalEPP()">×</button>
        <h3>Asignación de EPP</h3>
        <form id="formEPP">
            <label>Nombre y Apellidos:</label>
            <select id="trabajadorEPP" required></select>
            <label>EPP entregado:</label>
            <select id="tipoEPP" required>
                <option value="Casco">Casco</option>
                <option value="Botas">Botas</option>
                <option value="Guantes">Guantes</option>
            </select>
            <label>Fecha de entrega de EPP:</label>
            <input type="date" id="fechaEntregaEPP" required>
            <label>Fecha de vencimiento de EPP:</label>
            <input type="date" id="vencimientoEPP" required>
            <button type="submit">Asignar</button>
        </form>
    </div>
</div>



        <!-- Sección de Operación -->
<div id="operacion" class="container">
  <!-- Cabecera Rediseñada -->
  <div class="jornadas-header">
    <h4>📅 Registro de Jornadas</h4>
    <div class="header-actions">
      <button onclick="abrirModalJornada()" class="btn-registrar">
        <i class="fas fa-plus"></i> Nuevo Turno
      </button>
      <button onclick="descargarExcel()" class="btn-exportar">
        <i class="fas fa-file-excel"></i> Excel
      </button>
    </div>
  </div>

  <!-- Filtros Compactos -->
  <div class="filtros-compactos">
    <div class="filtro-group">
      <input type="date" id="fechaInicio" class="input-fecha" onchange="filtrarJornadas()">
      <input type="date" id="fechaFin" class="input-fecha" onchange="filtrarJornadas()">
    </div>
    <div class="filtro-group">
      <select id="filtroSede" onchange="filtrarJornadas()" class="select-filtro">
        <option value="">Todas las sedes</option>
      </select>
      <select id="filtroOperacion" onchange="filtrarJornadas()" class="select-filtro">
        <option value="">Todas las operaciones</option>
      </select>
    </div>
  </div>

  <!-- Tarjetas de Resumen -->
  <div class="resumen-jornadas">
    <div class="resumen-card">
      <span>Horas Totales</span>
      <h3 id="totalHoras">0</h3>
    </div>
    <div class="resumen-card">
      <span>Horas Extras</span>
      <h3 id="totalExtras">0</h3>
    </div>
    <div class="resumen-card highlight">
      <span>Total a Pagar</span>
      <h3 id="totalPago">$0</h3>
    </div>
  </div>

  <!-- Tabla Optimizada (Manteniendo estructura original) -->
  <div class="table-container">
    <table class="tabla-optimizada">
      <thead>
        <tr>
          <th>Colaborador</th>
          <th class="text-center">Fecha</th>
          <th class="text-center">Horas</th>
          <th class="text-center">Tipo</th>
          <th class="text-center">Estado</th>
          <th class="text-right">Valor</th>
          <th class="text-center">Acciones</th>
        </tr>
      </thead>
      <tbody id="tablaRegistrosJornadas">
        <!-- Contenido dinámico manteniendo misma estructura -->
      </tbody>
    </table>
  </div>
</div>

        <!-- Sección de Financiera -->
        <div id="financiera" class="container">
            <h2>Financiera</h2>
            <button onclick="mostrarSubseccion('tarifas')">Configuración de Tarifas</button>
            <button onclick="mostrarSubseccion('nomina')">Generar Nómina</button>
            <button onclick="mostrarSubseccion('sedes')">Gestión de Sedes</button>
	<button onclick="mostrarSubseccion('prefacturacion')">Prefacturación</button>
	<button onclick="mostrarSubseccion('comparativo')">Comparativo</button>
	<button onclick="mostrarSubseccion('modificaciones')">Modificaciones</button>
            <button onclick="mostrarSubseccion('facturacion')">Facturación</button>

            <!-- Subsección de Configuración de Tarifas -->
            <div id="tarifas" class="subseccion">
                <h3>Configuración de Tarifas</h3>
                <button onclick="abrirModalTarifa()">Agregar Nueva Tarifa</button>
                <h2>Tarifas por Sede</h2>
<table>
    <thead>
        <tr>
            <th>Sede</th>
            <th>Operación</th>
            <th>Hora Diurna (Pago)</th>
            <th>Hora Extra Diurna (Pago)</th>
            <th>Hora Nocturna (Pago)</th>
            <th>Hora Extra Nocturna (Pago)</th>
            <th>Hora Dominical/Festiva (Pago)</th>
            <th>Hora Diurna (Cobro)</th>
            <th>Hora Extra Diurna (Cobro)</th>
            <th>Hora Nocturna (Cobro)</th>
            <th>Hora Extra Nocturna (Cobro)</th>
            <th>Hora Dominical/Festiva (Cobro)</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody id="tablaTarifas"></tbody>
</table>
            </div>

            <!-- Subsección de Prefacturas -->
            <div id="prefectura" class="subseccion">
                <h3>Prefacturas</h3>
                <button onclick="prefactura()">Agregar Nueva Tarifa</button>
                <h2>Prefactura</h2>
<table>
    <thead>
        <tr>
            <th>Sede</th>
            <th>Operación</th>
            <th>Hora Diurna</th>
            <th>Hora Extra Diurna</th>
            <th>Hora Nocturna</th>
            <th>Hora Extra Nocturna</th>
            <th>Hora Dominical/Festiva</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody id="tablaTarifas"></tbody>
</table>
            </div>

            <!-- Subsección de Generar Nómina -->
            <div id="nomina" class="subseccion">
                <h3>Generar Nómina</h3>
                <form id="nominaForm">
                    <label>Seleccione el período:</label>
                    <input type="month" id="periodoNomina" required>
                    <button type="submit">Generar Nómina</button>
                </form>
                <div id="resultadoNomina"></div>
            </div>


<!-- Añadir estas subsecciones -->
<div id="prefacturacion" class="subseccion">

    <h3>Prefacturación</h3>
    
    <!-- Sección de Cargue de Datos -->
            <div class="card mb-4">
                <div class="card-body">
                    <form id="formCarguePrefactura">
                        <div class="row g-3">
                            <div class="col-md-3">
                                <input type="date" id="fechaPrefactura" class="form-control" required>
                            </div>
                            <div class="col-md-3">
                                <select id="clientePrefactura" class="form-select" required>
                                    <option value="">Seleccionar Cliente</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <input type="file" id="archivoCSV" class="form-control" accept=".csv" required>
                            </div>
                            <div class="col-md-3">
                                <button type="submit" class="btn btn-primary w-100">Procesar</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">📄 Listado de Prefacturas</h5>
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Cliente</th>
                                <th>Horas</th>
                                <th>Tarifa</th>
                                <th>Total</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tablaPrefacturas"></tbody>
                    </table>
                </div>
            </div>

            <div class="card mt-4">
                <div class="card-body">
                    <h5 class="card-title">📊 Comparativo Nómina</h5>
                    <div id="comparativoNomina" class="alert alert-info"></div>
                </div>
            </div>



</div>

<div id="comparativo" class="subseccion">
    <!-- Contenido completo de <section id="comparativo"> -->
</div>

<div id="modificaciones" class="subseccion">
    <!-- Contenido completo de <section id="modificacion"> -->
</div>


            <!-- Subsección de Facturación -->
            <div id="facturacion" class="subseccion">
                <h3>Facturación</h3>
                <form id="facturacionForm">
                    <label>Cliente:</label>
                    <input type="text" id="clienteFacturacion" required>
                    <label>Monto:</label>
                    <input type="number" id="montoFacturacion" required>
                    <label>Fecha de emisión:</label>
                    <input type="date" id="fechaFacturacion" required>
                    <button type="submit">Generar Factura</button>
                </form>
                <div id="resultadoFacturacion"></div>
            </div>

<!-- Subsección de Gestión de Sedes -->
<div id="sedes" class="subseccion">
    <h3>Gestión de Sedes</h3>
<button onclick="abrirModalSede()">Agregar Nueva Sede</button>
    <button onclick="document.getElementById('fileInput').click()">Importar desde Excel</button>
    <input type="file" id="fileInput" style="display: none;" onchange="importarDesdeExcel(event)">
    <h2>Lista de Sedes</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Ciudad</th>
                <th>Cliente</th>
                <th>Operaciones</th>
                <th>NIT</th>
                <th>Dirección</th>
                <th>Teléfono</th>
                <th>Fecha de Registro</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="tablaSedes">

        ${sedes.map(sede => `
            <tr>
                <td>${sede.ciudad}</td>
                <td>${sede.cliente}</td>
                <td>${sede.operaciones.join(', ')}</td>
                <!-- Resto de celdas -->
            </tr>
        `).join('')}

</tbody>
    </table>
</div>

        </div>

        <!-- Sección de Informe -->
        <div id="informe" class="container">
            <h2>Informes Generales</h2>
            <button onclick="generarInforme()">Generar Informe</button>
            <div id="resultadoInforme"></div>
        </div>

        <!-- Sección de Personal -->
        <div id="personal" class="container">
            <h2>Modulo Colaborador</h2>
	<button onclick="mostrarColillaPago()">Mi colilla de pago</button>
    <!-- Formulario para seleccionar la quincena -->
    <div id="formularioColilla" style="display: none;">
        <label>Seleccione la quincena:</label>
        <input type="date" id="fechaInicioColilla" onchange="cargarColillaPago()">
        <input type="date" id="fechaFinColilla" onchange="cargarColillaPago()">
    </div>

    <!-- Tabla para mostrar la colilla de pago -->
    <div id="colillaPago" style="display: none;">
        <h3>Colilla de Pago</h3>
        <table>
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Sede</th>
                    <th>Horas Trabajadas</th>
                    <th>Valor del Día</th>
                    <th>Total a Pagar</th>
                </tr>
            </thead>
            <tbody id="tablaColillaPago"></tbody>
        </table>
        <div class="total" id="totalColillaPago"></div>
    </div>
    <div id="resultadoColilla"></div>
</div>

        <!-- Modal para Registrar Trabajadores -->
       <div id="modalTrabajadores" class="modal">
    <div class="modal-contenido">

<!-- Botón (X) para cerrar el modal -->
<button onclick="cerrarModalTrabajador()" class="btn-X">×</button>

<!-- Eliminar el botón duplicado -->
<!-- <button onclick="abrirModalTrabajador()" class="btn-registrar-trabajador">Registrar Trabajador</button> -->

<h6>Registrar Trabajador</h6>
<form id="registroForm">
    <div class="form-grid">
        <!-- Sección de la foto -->
        <div class="photo-section">
            <img id="fotoTrabajadorPreview" alt="Foto del Trabajador">
            <input type="file" id="fotoTrabajador" accept="image/*" required>
        </div>

        <!-- Información Básica -->
        <div class="form-group">
            <label for="nombreApellidos">Nombre y Apellidos:</label>
            <input type="text" id="nombreApellidos" required>
        </div>
        <div class="form-group">
            <label for="correoElectronico">Correo Electrónico:</label>
            <input type="email" id="correoElectronico" required>
        </div>
        <div class="form-group">
            <label for="tipoDocumento">Tipo de Documento:</label>
            <select id="tipoDocumento" required>
                <option value="-">- -</option>
                <option value="CC">Cédula de Ciudadanía</option>
                <option value="CE">Cédula de Extranjería</option>
                <option value="Pasaporte">Pasaporte</option>
            </select>
        </div>
        <div class="form-group">
            <label for="numeroDocumento">Número de Documento:</label>
            <input type="text" id="numeroDocumento" required>
        </div>
<div class="form-group">
    <label for="fechaNacimiento">Fecha de Nacimiento:</label>
    <input type="date" id="fechaNacimiento" onchange="validarEdad(this)" required>
</div>
        <div class="form-group">
            <label for="rh">RH:</label>
            <select id="rh" required>
                <option value="-">- -</option>
		<option value="A+">A+</option>
		<option value="A-">A-</option>
		<option value="B+">B+</option>
		<option value="B-">B-</option>
		<option value="AB+">AB+</option>
		<option value="AB-">AB-</option>
		<option value="O+">O+</option>
		<option value="O-">O-</option>
	    </select>
        </div>
        <div class="form-group">
            <label for="genero">Género:</label>
            <select id="genero" required>
                <option value="-">- -</option>
                <option value="Masculino">Masculino</option>
                <option value="Femenino">Femenino</option>
                <option value="Otro">Otro</option>
            </select>
        </div>
        <div class="form-group">
            <label for="ciudad">Ciudad:</label>
            <input type="text" id="ciudad" required>
        </div>
        <div class="form-group">
            <label for="barrioResidencia">Barrio de Residencia:</label>
            <input type="text" id="barrioResidencia" required>
        </div>
        <div class="form-group">
            <label for="direccionResidencia">Dirección de Residencia:</label>
            <input type="text" id="direccionResidencia" required>
        </div>
        <div class="form-group">
            <label for="telefonoContacto">Teléfono de Contacto:</label>
            <input type="tel" id="telefonoContacto" required>
        </div>
        <div class="form-group">
            <label for="telefonoEmergencia">Teléfono de Emergencia:</label>
            <input type="tel" id="telefonoEmergencia" required>
        </div>
        <div class="form-group">
            <label for="estadoCivil">Estado Civil:</label>
            <select id="estadoCivil" required>
                <option value="-">- -</option>
                <option value="Soltero">Soltero</option>
                <option value="Casado">Casado</option>
                <option value="Divorciado">Divorciado</option>
                <option value="Viudo">Viudo</option>
            </select>
        </div>
        <div class="form-group">
            <label for="numeroHijos">Número de Hijos:</label>
            <input type="number" id="numeroHijos" min="0" required>
        </div>
        <div class="form-group">
            <label for="edadHijos">Edad de los Hijos:</label>
            <input type="text" id="edadHijos">
        </div>
        <div class="form-group">
            <label for="arl">ARL:</label>
            <select id="arl" required>
                <option value="-">- -</option>
		<option value="AXA Colpatria Seguros S.A.">AXA Colpatria Seguros S.A.</option>
		<option value="ARL Colmena">ARL Colmena</option>
		<option value="ARL La Equidad Seguros">ARL La Equidad Seguros</option>
		<option value="ARL Liberty Seguros">ARL Liberty Seguros</option>
		<option value="ARL Mapfre">ARL Mapfre</option>
		<option value="ARL Positiva">ARL Positiva</option>
		<option value="ARL Seguros Alfa">ARL Seguros Alfa</option>
		<option value="ARL Seguros Aurora">ARL Seguros Aurora</option>
		<option value="ARL Seguros Bolívar">ARL Seguros Bolívar</option>
		<option value="ARL Sura">ARL Sura</option>
            </select>
        </div>
        <div class="form-group">
            <label for="eps">EPS:</label>
            <select id="eps" required>
                <option value="-">- -</option>
		<option value="Aliansalud EPS">Aliansalud EPS</option>
		<option value="Compensar EPS">Compensar EPS</option>
		<option value="Sanitas EPS">Sanitas EPS</option>
		<option value="EPS Sura">EPS Sura</option>
		<option value="Salud Total EPS">Salud Total EPS</option>
		<option value="Nueva EPS">Nueva EPS</option>
		<option value="Coosalud EPS">Coosalud EPS</option>
		<option value="Famisanar EPS">Famisanar EPS</option>
		<option value="Capital Salud EPS">Capital Salud EPS</option>
		<option value="SOS EPS">SOS EPS</option>
		<option value="Mutual Ser EPS">Mutual Ser EPS</option>
		<option value="Emssanar EPS">Emssanar EPS</option>
		<option value="EPM Salud EPS">EPM Salud EPS</option>
		<option value="Ecoopsos EPS">Ecoopsos EPS</option>
		<option value="Anaswayuu EPS">Anaswayuu EPS</option>
		<option value="Asmet Salud EPS">Asmet Salud EPS</option>
		<option value="Cajacopi EPS">Cajacopi EPS</option>
		<option value="Capresoca EPS">Capresoca EPS</option>
		<option value="Dusakawi EPS">Dusakawi EPS</option>
		<option value="Mallamas EPS">Mallamas EPS</option>
            </select>
        </div>
        <div class="form-group">
            <label for="pension">Pensión:</label>
            <select id="pension" required>
                <option value="-">- -</option>
		<option value="Colpensiones">Colpensiones</option>
		<option value="Porvenir">Porvenir</option>
		<option value="Protección">Protección</option>
		<option value="Colfondos">Colfondos</option>
		<option value="Skandia">Skandia</option>
            </select>
        </div>
        <div class="form-group">
            <label for="cesantias">Cesantías:</label>
            <select id="cesantias" required>
                <option value="-">- -</option>
		<option value="Porvenir">Porvenir</option>
		<option value="Protección">Protección</option>
		<option value="Colfondos">Colfondos</option>
		<option value="Skandia">Skandia</option>
		<option value="Fondo Nacional del Ahorro">Fondo Nacional del Ahorro</option>
            </select>
        </div>

        <!-- Información Académica -->
        <div class="form-group full-width">
            <h4>Información Académica</h4>
        </div>
        <div class="form-group">
            <label for="tituloObtenido">Título Obtenido:</label>
            <input type="text" id="tituloObtenido">
        </div>
        <div class="form-group">
            <label for="institucion">Institución:</label>
            <input type="text" id="institucion">
        </div>
        <div class="form-group">
            <label for="ciudadAcademica">Ciudad Académica:</label>
            <input type="text" id="ciudadAcademica">
        </div>
        <div class="form-group">
            <label for="ultimoGrado">Último Grado:</label>
            <input type="text" id="ultimoGrado">
        </div>
        <div class="form-group">
            <label for="anioCulminado">Año Culminado:</label>
            <input type="date" id="anioCulminado">
        </div>

        <!-- Información Laboral -->
        <div class="form-group full-width">
            <h4>Información Laboral</h4>
        </div>
        <div class="form-group">
            <label for="empresa">Empresa:</label>
            <input type="text" id="empresa">
        </div>
        <div class="form-group">
            <label for="cargo">Cargo:</label>
            <input type="text" id="cargo">
        </div>
        <div class="form-group">
            <label for="LaborEx">Labores:</label>
            <input type="text" id="LaborEx">
        </div>
        <div class="form-group">
            <label for="fechaIngresoLaboral">Fecha de Ingreso:</label>
            <input type="date" id="fechaIngresoLaboral">
        </div>
        <div class="form-group">
            <label for="fechaRetiroLaboral">Fecha de Retiro:</label>
            <input type="date" id="fechaRetiroLaboral">
        </div>
        <div class="form-group">
            <label for="telefonoLaboral">Teléfono:</label>
            <input type="tel" id="telefonoLaboral">
        </div>

        <!-- Información Familiar -->
        <div class="form-group full-width">
            <h4>Información Familiar</h4>
        </div>
        <div class="form-group">
            <label for="parentesco">Parentesco:</label>
            <input type="text" id="parentesco">
        </div>
        <div class="form-group">
            <label for="nombreFamiliar">Nombre:</label>
            <input type="text" id="nombreFamiliar">
        </div>
        <div class="form-group">
            <label for="telefonoFamiliar">Teléfono:</label>
            <input type="tel" id="telefonoFamiliar">
        </div>

        <!-- Contratación -->
        <div class="form-group full-width">
            <h4>Contratación</h4>
        </div>
        <div class="form-group">
            <label for="Modcontrato">Modelo de contrato:</label>
            <select id="Modcontrato" required>
                <option value="-">- -</option>
                <option value="ObraLabor">Obra y Labor</option>
                <option value="PrestacionServicios">Prestación de Servicios</option>
                <option value="Indefinido">Indefinido</option>
                <option value="Definido">Definido</option>
            </select>
        </div>
        <div class="form-group">
            <label for="PerfilCargo">Perfil del cargo:</label>
            <select id="PerfilCargo" required>
                <option value="-">- -</option>
                <option value="GerenteGeneral">Gerente General</option>
                <option value="GerenteAdministrativa">Gerente Administrativo</option>
                <option value="IngenieroProyectos">Ingeniero de Proyectos</option>
                <option value="JefeOperaciones">Jefe de Operaciones</option>
                <option value="JefeRRHH">Jefe Recursos Humanos</option>
                <option value="NominaYFacturacion">Nómina y Facturación</option>
                <option value="CoordinadorOperaciones">Coordinador de Operaciones</option>
                <option value="ContadorPublico">Contador Público</option>
                <option value="CoordinadorComercial">Coordinador Comercial</option>
                <option value="CoordinadorSST">Coordinador SST</option>
                <option value="AuxiliarAdministrativo">Auxiliar Administrativo</option>
                <option value="AnalistaOperacionesSAC">Analista de Operaciones y SAC</option>
                <option value="Supervisor">Supervisor</option>
                <option value="AnalistaContable">Analista Contable</option>
                <option value="CoordinadorRRHH">Coordinador RRHH</option>
                <option value="AuxiliarLogistico">Auxiliar Logístico</option>
                <option value="Montacarguista">Montacarguista</option>
                <option value="ConductorC1">Conductor C1</option>
                <option value="ConductorC2">Conductor C2</option>
                <option value="Motorizado">Motorizado</option>
                <option value="Mensajero">Mensajero</option>
            </select>
        </div>
<!-- Capacitaciones Recibidas -->
<div class="form-group full-width">
    <h4>Capacitaciones Recibidas</h4>
    <label><input type="checkbox" id="capacitacion1" name="capacitaciones" value="Inducción y reinducción"> Inducción y reinducción</label>
    <label><input type="checkbox" id="capacitacion2" name="capacitaciones" value="Buenas practicas"> Buenas practicas</label>
    <label><input type="checkbox" id="capacitacion3" name="capacitaciones" value="Accidentes"> Accidentes</label>
    <label><input type="checkbox" id="capacitacion4" name="capacitaciones" value="Riesgos"> Riesgos</label>
    <label><input type="checkbox" id="capacitacion5" name="capacitaciones" value="Comites y brigada"> Comites y brigada</label>
    <label><input type="checkbox" id="capacitacion6" name="capacitaciones" value="Actos y condiciones inseguras"> Actos y condiciones inseguras</label>
    <label><input type="checkbox" id="capacitacion7" name="capacitaciones" value="¿Que hacer en casos de emergencias?"> ¿Que hacer en casos de emergencias?</label>
    <label><input type="checkbox" id="capacitacion8" name="capacitaciones" value="Dotación y EPP"> Dotación y EPP</label>
    <label><input type="checkbox" id="capacitacion9" name="capacitaciones" value="Politica SST"> Politica SST</label>
    <label><input type="checkbox" id="capacitacion10" name="capacitaciones" value="Politica de Prevención del Consumo de Alcohol, Tabaco y otras Sustancias Psicoactivas"> Politica de Prevención del Consumo de Alcohol, Tabaco y otras Sustancias Psicoactivas</label>
</div>

<!-- Documentos Recibidos -->
<div class="form-group full-width">
    <h4>Documentos Recibidos</h4>
    <label><input type="checkbox" id="documento1" name="documentos" value="Formato único de hoja de vida"> Formato único de hoja de vida</label>
    <label><input type="checkbox" id="documento2" name="documentos" value="Pruebas psicotecnicas"> Pruebas psicotecnicas</label>
    <label><input type="checkbox" id="documento3" name="documentos" value="Fotocopia documentos de identidad"> Fotocopia documentos de identidad</label>
    <label><input type="checkbox" id="documento4" name="documentos" value="Antecedentes disciplinarios (Procuraduría-Policía-Contraloria)"> Antecedentes disciplinarios (Procuraduría-Policía-Contraloria)</label>
    <label><input type="checkbox" id="documento5" name="documentos" value="Certificados laborales"> Certificados laborales</label>
    <label><input type="checkbox" id="documento6" name="documentos" value="Certificados de estudios"> Certificados de estudios</label>
    <label><input type="checkbox" id="documento7" name="documentos" value="Certificados de experiencia laboral"> Certificados de experiencia laboral</label>
    <label><input type="checkbox" id="documento8" name="documentos" value="Validación de referencias"> Validación de referencias</label>
    <label><input type="checkbox" id="documento9" name="documentos" value="Certificado afiliación a E.P.S."> Certificado afiliación a E.P.S.</label>
    <label><input type="checkbox" id="documento10" name="documentos" value="Certificado afiliación a A.F.P."> Certificado afiliación a A.F.P.</label>
    <label><input type="checkbox" id="documento11" name="documentos" value="Fotocopia registro unitario (R.U.T.)"> Fotocopia registro unitario (R.U.T.)</label>
    <label><input type="checkbox" id="documento12" name="documentos" value="Examen médico de ingreso"> Examen médico de ingreso</label>
    <label><input type="checkbox" id="documento13" name="documentos" value="Certificación bancaria"> Certificación bancaria</label>
    <label><input type="checkbox" id="documento14" name="documentos" value="Contrato y anexos"> Contrato y anexos</label>
</div>
        <!-- Cuenta bancaria -->
        <div class="form-group full-width">
            <h4>Cuenta Bancaria</h4>
        </div>
        <div class="form-group">
            <label for="TipoCuenta">Tipo de Cuenta:</label>
            <select id="TipoCuenta" required>
                <option value="-">- -</option>
                <option value="Ahorros">Ahorros</option>
                <option value="Corriente">Corriente</option>
            </select>
        </div>
        <div class="form-group">
            <label for="Banco">Entidad:</label>
            <select id="Banco" required>
                <option value="-">- -</option>
                <option value="Banco Caja Socia">Banco Caja Social</option>
                <option value="Bancolombia">Bancolombia</option>
                <option value="Banco de Bogotá">Banco de Bogotá</option>
                <option value="Banco de Occidente">Banco de Occidente</option>
                <option value="Banco Av Villas">Banco Av Villas</option>
                <option value="Banco Popular">Banco Popular</option>
                <option value="BBVA">BBVA</option>
                <option value="MOVII">MOVII</option>
                <option value="Banco Davivienda">Banco Davivienda</option>
                <option value="Daviplata">Banco Daviplata</option>
            </select>
        </div>

        <div class="form-group">
            <label for="tipoDocumentoTitular">Tipo de Documento del titular:</label>
            <select id="tipoDocumentoTitular" required>
                <option value="-">- -</option>
                <option value="Cédula de Ciudadanía">Cédula de Ciudadanía</option>
                <option value="Cédula de Extranjería">Cédula de Extranjería</option>
                <option value="Pasaporte">Pasaporte</option>
                <option value="NIT">NIT</option>
                <option value="Tarjeta de Identidad">Tarjeta de identidad</option>
            </select>
        </div>
        <div class="form-group">
            <label for="nombreTitular">Nombre del titular:</label>
            <input type="text" id="nombreTitular" required>
        </div>
        <div class="form-group">
            <label for="numeroDocumentotitular">Número de Documento titular:</label>
            <input type="text" id="numeroDocumentoTitular" required>
        </div>
        <div class="form-group">
	    <label for="numeroCuenta">Número de Cuenta:</label>
	    <input type="text" id="numeroCuenta" required> 
        </div>
    </div>
    <button type="submit" class="btn-registrar-trabajador">Registrar Trabajador</button>
</form>
<button class="modal-cerrar" onclick="cerrarModalTrabajador()">Cerrar</button>
    </div>
</div>




<!-- Modal para Editar Trabajadores -->
<div id="modalEditarTrabajador" class="modal">
    <div class="modal-contenido">
        <h2>Editar Trabajador</h2>
        <form id="editarTrabajadorForm">
            <input type="hidden" id="editarTrabajadorId">

            <!-- Campo para subir la foto -->
            <div id="vistaPreviaEditarFoto" style="text-align: center; margin-bottom: 20px;">
                <img id="editarFotoTrabajadorPreview" src="" alt="Foto del Trabajador" style="max-width: 150px; border-radius: 50%; display: none;">
            </div>
            <label>Foto del Trabajador:</label>
            <input type="file" id="editarFotoTrabajador" accept="image/*">

            <!-- Contenedor de tres columnas -->
            <div class="form-grid">
                <!-- Columna 1 -->
                <div class="form-group">
                    <label>Nombre y Apellidos:</label>
                    <input type="text" id="editarNombreApellidos" required>
                </div>
                <div class="form-group">
                    <label>Correo Electrónico:</label>
                    <input type="email" id="editarCorreoElectronico" required>
                </div>
                <div class="form-group">
                    <label>Tipo de Documento:</label>
                    <select id="editarTipoDocumento" required>
                        <option value="CC">Cédula de Ciudadanía</option>
                        <option value="CE">Cédula de Extranjería</option>
                        <option value="Pasaporte">Pasaporte</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Número de Documento:</label>
                    <input type="text" id="editarNumeroDocumento" required>
                </div>
                <div class="form-group">
                    <label>Fecha de Nacimiento:</label>
                    <input type="date" id="editarFechaNacimiento" required>
                </div>
                <div class="form-group">
                    <label>RH:</label>
                    <select id="editarRh" required>
                        <option value="A+">A+</option>
                        <option value="A-">A-</option>
                        <option value="B+">B+</option>
                        <option value="B-">B-</option>
                        <option value="AB+">AB+</option>
                        <option value="AB-">AB-</option>
                        <option value="O+">O+</option>
                        <option value="O-">O-</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Género:</label>
                    <select id="editarGenero" required>
                        <option value="Masculino">Masculino</option>
                        <option value="Femenino">Femenino</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ciudad:</label>
                    <input type="text" id="editarCiudad" required>
                </div>
                <div class="form-group">
                    <label>Barrio de Residencia:</label>
                    <input type="text" id="editarBarrioResidencia" required>
                </div>
                <div class="form-group">
                    <label>Dirección de Residencia:</label>
                    <input type="text" id="editarDireccionResidencia" required>
                </div>
                <div class="form-group">
                    <label>Teléfono de Contacto:</label>
                    <input type="tel" id="editarTelefonoContacto" required>
                </div>
                <div class="form-group">
                    <label>Teléfono de Emergencia:</label>
                    <input type="tel" id="editarTelefonoEmergencia" required>
                </div>
                <div class="form-group">
                    <label>Estado Civil:</label>
                    <select id="editarEstadoCivil" required>
                        <option value="Soltero">Soltero</option>
                        <option value="Casado">Casado</option>
                        <option value="Divorciado">Divorciado</option>
                        <option value="Viudo">Viudo</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Número de Hijos:</label>
                    <input type="number" id="editarNumeroHijos" min="0" required>
                </div>
                <div class="form-group">
                    <label>Edad de los Hijos:</label>
                    <input type="text" id="editarEdadHijos">
                </div>
                <div class="form-group">
                    <label>ARL:</label>
                    <select id="editarArl" required>
                        <option value="AXA Colpatria Seguros S.A.">AXA Colpatria Seguros S.A.</option>
                        <option value="ARL Colmena">ARL Colmena</option>
                        <option value="ARL La Equidad Seguros">ARL La Equidad Seguros</option>
                        <option value="ARL Liberty Seguros">ARL Liberty Seguros</option>
                        <option value="ARL Mapfre">ARL Mapfre</option>
                        <option value="ARL Positiva">ARL Positiva</option>
                        <option value="ARL Seguros Alfa">ARL Seguros Alfa</option>
                        <option value="ARL Seguros Aurora">ARL Seguros Aurora</option>
                        <option value="ARL Seguros Bolívar">ARL Seguros Bolívar</option>
                        <option value="ARL Sura">ARL Sura</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>EPS:</label>
                    <select id="editarEps" required>
                        <option value="Aliansalud EPS">Aliansalud EPS</option>
                        <option value="Compensar EPS">Compensar EPS</option>
                        <option value="Sanitas EPS">Sanitas EPS</option>
                        <option value="EPS Sura">EPS Sura</option>
                        <option value="Salud Total EPS">Salud Total EPS</option>
                        <option value="Nueva EPS">Nueva EPS</option>
                        <option value="Coosalud EPS">Coosalud EPS</option>
                        <option value="Famisanar EPS">Famisanar EPS</option>
                        <option value="Capital Salud EPS">Capital Salud EPS</option>
                        <option value="SOS EPS">SOS EPS</option>
                        <option value="Mutual Ser EPS">Mutual Ser EPS</option>
                        <option value="Emssanar EPS">Emssanar EPS</option>
                        <option value="EPM Salud EPS">EPM Salud EPS</option>
                        <option value="Ecoopsos EPS">Ecoopsos EPS</option>
                        <option value="Anaswayuu EPS">Anaswayuu EPS</option>
                        <option value="Asmet Salud EPS">Asmet Salud EPS</option>
                        <option value="Cajacopi EPS">Cajacopi EPS</option>
                        <option value="Capresoca EPS">Capresoca EPS</option>
                        <option value="Dusakawi EPS">Dusakawi EPS</option>
                        <option value="Mallamas EPS">Mallamas EPS</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Pensión:</label>
                    <select id="editarPension" required>
                        <option value="Colpensiones">Colpensiones</option>
                        <option value="Porvenir">Porvenir</option>
                        <option value="Protección">Protección</option>
                        <option value="Colfondos">Colfondos</option>
                        <option value="Skandia">Skandia</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Cesantías:</label>
                    <select id="editarCesantias" required>
                        <option value="Porvenir">Porvenir</option>
                        <option value="Protección">Protección</option>
                        <option value="Colfondos">Colfondos</option>
                        <option value="Skandia">Skandia</option>
                        <option value="Fondo Nacional del Ahorro">Fondo Nacional del Ahorro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Título Obtenido:</label>
                    <input type="text" id="editarTituloObtenido">
                </div>
                <div class="form-group">
                    <label>Institución:</label>
                    <input type="text" id="editarInstitucion">
                </div>
                <div class="form-group">
                    <label>Ciudad Académica:</label>
                    <input type="text" id="editarCiudadAcademica">
                </div>
                <div class="form-group">
                    <label>Último Grado:</label>
                    <input type="text" id="editarUltimoGrado">
                </div>
                <div class="form-group">
                    <label>Año Culminado:</label>
                    <input type="date" id="editarAnioCulminado">
                </div>
                <div class="form-group">
                    <label>Última Experiencia Laboral:</label>
                    <input type="text" id="editarUltimaExperiencia">
                </div>
                <div class="form-group">
                    <label>Empresa:</label>
                    <input type="text" id="editarEmpresa">
                </div>
                <div class="form-group">
                    <label>Cargo:</label>
                    <input type="text" id="editarCargo">
                </div>
                <div class="form-group">
                    <label>Fecha de Ingreso Laboral:</label>
                    <input type="date" id="editarFechaIngresoLaboral">
                </div>
                <div class="form-group">
                    <label>Fecha de Retiro Laboral:</label>
                    <input type="date" id="editarFechaRetiroLaboral">
                </div>
                <div class="form-group">
                    <label>Teléfono Laboral:</label>
                    <input type="tel" id="editarTelefonoLaboral">
                </div>
                <div class="form-group">
                    <label>Parentesco:</label>
                    <input type="text" id="editarParentesco">
                </div>
                <div class="form-group">
                    <label>Nombre del Familiar:</label>
                    <input type="text" id="editarNombreFamiliar">
                </div>
                <div class="form-group">
                    <label>Teléfono del Familiar:</label>
                    <input type="tel" id="editarTelefonoFamiliar">
                </div>
                <div class="form-group">
                    <label>Modelo de Contrato:</label>
                    <select id="editarModcontrato" required>
                        <option value="ObraLabor">Obra y Labor</option>
                        <option value="PrestacionServicios">Prestación de Servicios</option>
                        <option value="Indefinido">Indefinido</option>
                        <option value="Definido">Definido</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Capacitaciones Recibidas:</label>
                    <input type="text" id="editarCapacitacionesRecibidas">
                </div>
                <div class="form-group">
                    <label>Documentos Entregados:</label>
                    <input type="text" id="editarDocrecibidos">
                </div>
                <div class="form-group">
                    <label>Tipo de Cuenta:</label>
                    <select id="editarTipoCuenta" required>
                        <option value="Ahorros">Ahorros</option>
                        <option value="Corriente">Corriente</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Banco:</label>
                    <select id="editarBanco" required>
                        <option value="BANCO_CAJA_SOCIAL">Banco Caja Social</option>
                        <option value="BANCOLOMBIA">Bancolombia</option>
                        <option value="BANCO_DE_BOGOTA">Banco de Bogotá</option>
                        <option value="BANCO_DE_OCCIDENTE">Banco de Occidente</option>
                        <option value="BANCO_AV_VILLAS">Banco Av Villas</option>
                        <option value="DALE">Dale</option>
                        <option value="BANCO_POPULAR">Banco Popular</option>
                        <option value="BBVA">BBVA</option>
                        <option value="MOVII">MOVII</option>
                        <option value="BANCO_DAVIVIENDA">Banco Davivienda</option>
                        <option value="DAVIPLATA">Banco Daviplata</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Tipo de Documento del Titular:</label>
                    <select id="editarTipoDocumentoTitular" required>
                        <option value="CC">Cédula de Ciudadanía</option>
                        <option value="CE">Cédula de Extranjería</option>
                        <option value="Pasaporte">Pasaporte</option>
                        <option value="NIT">NIT</option>
                        <option value="TarjetadeIdentidad">Tarjeta de identidad</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Nombre del Titular:</label>
                    <input type="text" id="editarNombreTitular" required>
                </div>
                <div class="form-group">
                    <label>Número de Documento del Titular:</label>
                    <input type="text" id="editarNumeroDocumentoTitular" required>
                </div>
                <div class="form-group">
                    <label>Número de Cuenta:</label>
                    <input type="text" id="editarNumeroCuenta" required>
                </div>
            </div>
            <button type="submit" class="btn-registrar-trabajador">Guardar cambios</button>
        </form>
        <button class="modal-cerrar" onclick="cerrarModalEditarTrabajador()">Cerrar</button>
    </div>
</div>

<!-- Modal para Registrar Jornadas Laborales -->
<div id="modalJornadas" class="modal">
    <div class="modal-contenido">
        <h2>Registrar Jornada Laboral</h2>
        <form id="registroJornadaForm">
            <label>Nombre del trabajador:</label>
            <select id="nombreTrabajadorJornada" required>
                <option value="">Seleccione un trabajador</option>
            </select>

            <label>Ciudad:</label>
            <select id="ciudadJornada" required onchange="actualizarClientesPorCiudad()">
                <option value="">Seleccione ciudad</option>
            </select>

            <label>Sede de trabajo:</label>
            <select id="sede" required onchange="cargarLineas()">
                <option value="">Seleccione una sede</option>
            </select>
            <label>Operación:</label>
            <select id="operacion" required>
                <option value="">Seleccione una operación</option>
                <option value="Picking">Picking</option>
                <option value="Packing">Packing</option>
                <option value="Descarque">Descarque</option>
                <option value="Bodega">Bodega</option>
                <option value="Ruta">Ruta</option>
                <option value="Conductor">Conductor</option>
                <option value="Montacargas">Montacargas</option>
                <option value="Auxiliar">Auxiliar</option>
                <option value="Asesor Call Center">Asesor Call Center</option>
                <option value="Mensajero">Mensajero</option>
                <option value="Motorizado">Motorizado</option>
                <option value="Maquila">Maquila</option>
            </select>
            <label>Fecha:</label>
            <input type="date" id="fechaJornada" required>
            <label>Hora de inicio:</label>
            <input type="time" id="horaInicio" required>
            <label>Hora de fin:</label>
            <input type="time" id="horaFin" required>
            <label>Horas a descontar:</label>
            <input type="number" id="horasDescuento" min="0" step="0.5" value="0">
            <label>Tipo de Jornada:</label>
            <select id="tipoJornada" required>
                <option value="diurna">Diurna</option>
                <option value="nocturna">Nocturna</option>
                <option value="dominical">Dominical/Festiva</option>
            </select>
            <button type="submit">Registrar Jornada</button>
        </form>
        <button class="modal-cerrar" onclick="cerrarModalJornada()">Cerrar</button>
    </div>
</div>

        <!-- Modal para Editar Jornadas Laborales -->
        <div id="modalEditarJornada" class="modal">
            <div class="modal-contenido">
                <h2>Editar Jornada Laboral</h2>
                <form id="editarJornadaForm">
                    <input type="hidden" id="editarJornadaId">
                    <label>Nombre del trabajador:</label>
                    <select id="editarNombreTrabajadorJornada" required disabled>
                        <option value="">Seleccione un trabajador</option>
                    </select>
                    <label>Sede de trabajo:</label>
                    <select id="editarSede" required onchange="cargarLineasEditar()">
                        <option value="">Seleccione una sede</option>
                    </select>
                    <label>Línea:</label>
                    <select id="editarLinea" required>
                        <option value="">Seleccione una línea</option>
                    </select>
                    <label>Fecha:</label>
                    <input type="date" id="editarFechaJornada" required>
                    <label>Hora de inicio:</label>
                    <input type="time" id="editarHoraInicio" required>
                    <label>Hora de fin:</label>
                    <input type="time" id="editarHoraFin" required>
                    <label>Horas a descontar:</label>
                    <input type="number" id="editarHorasDescuento" min="0" step="0.5" value="0">
                    <label>Tipo de Jornada:</label>
                    <select id="editarTipoJornada" required>
                        <option value="diurna">Diurna</option>
                        <option value="nocturna">Nocturna</option>
                        <option value="dominical">Dominical/Festiva</option>
                    </select>
	<button onclick="abrirModalTrabajador()" class="btn-registrar-trabajador">Guardar cambios</button>
                </form>
                <button class="modal-cerrar" onclick="cerrarModalEditarJornada()">Cerrar</button>
            </div>
        </div>

        <!-- Modal para Agregar Tarifas -->
<div id="modalTarifas" class="modal">
    <div class="modal-contenido">

        <h2>Agregar Tarifa</h2>
        <form id="tarifasForm">
            <label>Registrar Tarifas por Ciudad:</label>
            <select id="sedeTarifa" required onchange="cargarTarifas()">
                <option value="">Seleccione una ciudad</option>
            </select>
            <label>Cliente:</label>
            <select id="clienteTarifa" required>
                <option value="">Seleccione un cliente</option>
                <!-- Las opciones se llenarán dinámicamente con JavaScript -->
            </select>
            <label>Operación:</label>
            <select id="operacionTarifa" required>
                <option value="">Seleccione una operación</option>
                <option value="Picking">Picking</option>
                <option value="Packing">Packing</option>
                <option value="Descarque">Descarque</option>
                <option value="Bodega">Bodega</option>
                <option value="Ruta">Ruta</option>
                <option value="Conductor">Conductor</option>
                <option value="Montacargas">Montacargas</option>
                <option value="Auxiliar">Auxiliar</option>
                <option value="Asesor Call Center">Asesor Call Center</option>
                <option value="Mensajero">Mensajero</option>
                <option value="Motorizado">Motorizado</option>
                <option value="Maquila">Maquila</option>
            </select>

            <h4>Tarifas de Pago</h4>
            <label>Valor por hora diurna (pago):</label>
            <input type="number" id="tarifaDiurnaPago" min="0" required>
            <label>Valor por hora extra diurna (pago):</label>
            <input type="number" id="tarifaExtraDiurnaPago" min="0" required>
            <label>Valor por hora nocturna (pago):</label>
            <input type="number" id="tarifaNocturnaPago" min="0" required>
            <label>Valor por hora extra nocturna (pago):</label>
            <input type="number" id="tarifaExtraNocturnaPago" min="0" required>
            <label>Valor por hora dominical/festiva (pago):</label>
            <input type="number" id="tarifaDominicalPago" min="0" required>

            <h4>Tarifas de Cobro</h4>
            <label>Valor por hora diurna (cobro):</label>
            <input type="number" id="tarifaDiurnaCobro" min="0" required>
            <label>Valor por hora extra diurna (cobro):</label>
            <input type="number" id="tarifaExtraDiurnaCobro" min="0" required>
            <label>Valor por hora nocturna (cobro):</label>
            <input type="number" id="tarifaNocturnaCobro" min="0" required>
            <label>Valor por hora extra nocturna (cobro):</label>
            <input type="number" id="tarifaExtraNocturnaCobro" min="0" required>
            <label>Valor por hora dominical/festiva (cobro):</label>
            <input type="number" id="tarifaDominicalCobro" min="0" required>

            <button type="submit">Guardar Tarifa</button>
        </form>
        <button class="modal-cerrar" onclick="cerrarModalTarifa()">Cerrar</button>
    </div>
</div>

<!-- Modal para Editar Tarifas -->
<div id="modalEditarTarifa" class="modal">
    <div class="modal-contenido">
        <h2>Editar Tarifa</h2>
        <form id="editarTarifasForm">
            <label>Sede:</label>
            <input type="text" id="editarSedeTarifa" required>

            <label>Operación:</label>
            <input type="text" id="editarOperacionTarifa" required>

            <h4>Tarifas de Pago</h4>
            <label>Valor por hora diurna (pago):</label>
            <input type="number" id="editarTarifaDiurnaPago" required>

            <label>Valor por hora extra diurna (pago):</label>
            <input type="number" id="editarTarifaExtraDiurnaPago" required>

            <label>Valor por hora nocturna (pago):</label>
            <input type="number" id="editarTarifaNocturnaPago" required>

            <label>Valor por hora extra nocturna (pago):</label>
            <input type="number" id="editarTarifaExtraNocturnaPago" required>

            <label>Valor por hora dominical/festiva (pago):</label>
            <input type="number" id="editarTarifaDominicalPago" required>

            <h4>Tarifas de Cobro</h4>
            <label>Valor por hora diurna (cobro):</label>
            <input type="number" id="editarTarifaDiurnaCobro" required>

            <label>Valor por hora extra diurna (cobro):</label>
            <input type="number" id="editarTarifaExtraDiurnaCobro" required>

            <label>Valor por hora nocturna (cobro):</label>
            <input type="number" id="editarTarifaNocturnaCobro" required>

            <label>Valor por hora extra nocturna (cobro):</label>
            <input type="number" id="editarTarifaExtraNocturnaCobro" required>

            <label>Valor por hora dominical/festiva (cobro):</label>
            <input type="number" id="editarTarifaDominicalCobro" required>

            <button type="submit">Guardar Cambios</button>
        </form>
        <button class="modal-cerrar" onclick="cerrarModalEditarTarifa()">Cerrar</button>
    </div>
</div>

        <!-- Modal para Agregar Sedes -->
<div id="modalSede" class="modal">
    <div class="modal-contenido">
        <h3>Agregar Nueva Sede</h3>
        <label>Ciudad:</label>
        <input type="text" id="ciudadSede" required>

        <label>Cliente:</label>
        <input type="text" id="clienteSede" required>

<label>Operación:</label>
<div id="operacionesChecklist">
    <label><input type="checkbox" name="operacion" value="Picking"> Picking</label><br>
    <label><input type="checkbox" name="operacion" value="Packing"> Packing</label><br>
    <label><input type="checkbox" name="operacion" value="Descarque"> Descarque</label><br>
    <label><input type="checkbox" name="operacion" value="Bodega"> Bodega</label><br>
    <label><input type="checkbox" name="operacion" value="Ruta"> Ruta</label><br>
    <label><input type="checkbox" name="operacion" value="Conductor"> Conductor</label><br>
    <label><input type="checkbox" name="operacion" value="Montacargas"> Montacargas</label><br>
    <label><input type="checkbox" name="operacion" value="Auxiliar"> Auxiliar</label><br>
    <label><input type="checkbox" name="operacion" value="Asesor Call Center"> Asesor Call Center</label><br>
    <label><input type="checkbox" name="operacion" value="Mensajero"> Mensajero</label><br>
    <label><input type="checkbox" name="operacion" value="Motorizado"> Motorizado</label><br>
    <label><input type="checkbox" name="operacion" value="Maquila"> Maquila</label><br>
</div>

        <label>NIT:</label>
        <input type="text" id="nitSede" required>

        <label>Dirección:</label>
        <input type="text" id="direccionSede" required>

        <label>Teléfono:</label>
        <input type="text" id="telefonoSede" required>

        <div class="form-group">
            <label>Fecha de Creación:</label>
    <input type="date" id="fechaCreacion" required>
        </div>

        <button onclick="guardarSede()">Guardar</button>
        <button onclick="cerrarModalSede()">Cerrar</button>
    </div>
</div>

        <!-- Modal para Agregar Usuarios -->
        <div id="modalUsuarios" class="modal">
            <div class="modal-contenido">
                <h2>Agregar Usuario</h2>
                <form id="usuariosForm">
                    <label>Nombre de usuario:</label>
                    <input type="text" id="nombreUsuario" required>
                    <label>Contraseña:</label>
                    <input type="password" id="contrasenaUsuario" required>
                    <label>Acceso a Registro de Trabajadores:</label>
                    <input type="checkbox" id="accesoTrabajadores">
                    <label>Acceso a Registro de Jornadas:</label>
                    <input type="checkbox" id="accesoJornadas">
                    <label>Acceso a Tarifas:</label>
                    <input type="checkbox" id="accessoTarifas">
                    <label>Acceso a Sedes:</label>
                    <input type="checkbox" id="accessoSedes">
                    <button type="submit">Guardar Usuario</button>
                </form>
                <button class="modal-cerrar" onclick="cerrarModalUsuario()">Cerrar</button>
            </div>
        </div>

        <!-- Modal para Editar Usuarios -->
        <div id="modalEditarUsuario" class="modal">
            <div class="modal-contenido">
                <h2>Editar Usuario</h2>
                <form id="editarUsuarioForm">
                    <input type="hidden" id="editarUsuarioId">
                    <label>Nombre de usuario:</label>
                    <input type="text" id="editarNombreUsuario" required disabled>
                    <label>Acceso a Registro de Trabajadores:</label>
                    <input type="checkbox" id="editarAccesoTrabajadores">
                    <label>Acceso a Registro de Jornadas:</label>
                    <input type="checkbox" id="editarAccesoJornadas">
                    <label>Acceso a Tarifas:</label>
                    <input type="checkbox" id="editarAccessoTarifas">
                    <label>Acceso a Sedes:</label>
                    <input type="checkbox" id="editarAccessoSedes">
	<button type="submit" class="btn-registrar-trabajador">Guardar cambios</button>
                </form>
                <button class="modal-cerrar" onclick="cerrarModalEditarUsuario()">Cerrar</button>
            </div>
        </div>
    </div>

    <script>


        let tarifas = JSON.parse(localStorage.getItem("tarifas")) || [];
	let trabajadores = JSON.parse(localStorage.getItem("trabajadores")) || [];
        let registrosJornadas = JSON.parse(localStorage.getItem("registrosJornadas")) || [];
        let sedes = JSON.parse(localStorage.getItem("sedes")) || [];
        let usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
        let usuarioActual = null;
	let idCounter = 0;

function inicializarContador() {
    const contadorGuardado = localStorage.getItem('idCounter');
    idCounter = contadorGuardado ? parseInt(contadorGuardado) : 0;
}

inicializarContador(); 

function generarIdUnico() {
    idCounter++;
    localStorage.setItem('idCounter', idCounter.toString());
    return idCounter;
}

function iniciarSesion() {
    const usuario = document.getElementById("usuario").value.trim();
    const contrasena = document.getElementById("contrasena").value.trim();
    const usuarioEncontrado = usuarios.find(u => 
        u.nombre.toLowerCase() === usuario.toLowerCase() && 
        u.contrasena === contrasena
    );
    if (usuarioEncontrado) {
        usuarioActual = usuarioEncontrado;
        document.body.classList.remove("login-page");
        document.body.classList.add("internal-page");
        document.body.style.backgroundImage = "none";
        document.querySelector(".login-container").style.display = "none";
        document.getElementById("mainContent").style.display = "block";
        document.getElementById("nombreUsuarioActual").textContent = usuarioActual.nombre;
        mostrarSeccion('personal'); // Mostrar la sección de Personal por defecto
        actualizarTabsSegunPermisos();
    } else {
        Swal.fire("Error", "Usuario o contraseña incorrectos", "error");
    }
}


function subirFoto(file) {
    const formData = new FormData();
    formData.append("foto", file);
    fetch("/subir-foto", {
        method: "POST",
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.url) {
            // Guardar la URL en el localStorage
            localStorage.setItem("fotoTrabajador", data.url);
        }
    });
}

function generarContraseñaSegura() {
    const caracteres = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
    let contraseña = "";
    for (let i = 0; i < 10; i++) {
        contraseña += caracteres.charAt(Math.floor(Math.random() * caracteres.length));
    }
    return contraseña;
}



        // Cerrar sesión
        function cerrarSesion() {
            usuarioActual = null;
            document.body.classList.remove("internal-page");
            document.body.classList.add("login-page");
            document.body.style.backgroundImage = "url('https://via.placeholder.com/1920x1080')";
            document.querySelector(".login-container").style.display = "block";
            document.getElementById("mainContent").style.display = "none";
        }

        // Actualizar las pestañas según los permisos del usuario
function actualizarTabsSegunPermisos() {
    const tabs = document.querySelectorAll(".tabs button");
    tabs.forEach(tab => {
        const seccion = tab.getAttribute("onclick").replace("mostrarSeccion('", "").replace("')", "");
        if (usuarioActual.nombre === "Gerente") {
            tab.style.display = "inline-block"; // Mostrar todas las pestañas
        } else {
            if (!usuarioActual[`acceso${seccion.charAt(0).toUpperCase() + seccion.slice(1)}`]) {
                tab.style.display = "none";
            } else {
                tab.style.display = "inline-block";
            }
        }
    });
}

// Inicialización de usuarios al cargar la página
document.addEventListener("DOMContentLoaded", function() {
    let usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
    if (usuarios.length === 0) {
        usuarios.push({
            nombre: "Gerente",
            contrasena: "AMALOGISTICA",
            accesoTrabajadores: true,
            accesoJornadas: true,
            accessoTarifas: true,
            accessoSedes: true
        });
        localStorage.setItem("usuarios", JSON.stringify(usuarios));
    }
    mostrarUsuarios(); // Llamar a la función después de inicializar
});

// Función para mostrar usuarios en la tabla
function mostrarUsuarios() {
    let tbody = document.getElementById("tablaUsuarios");
    tbody.innerHTML = "";
    usuarios.forEach((usuario, index) => {
        let fila = `<tr>
            <td>${usuario.nombre}</td>
            <td>${usuario.accesoTrabajadores ? "✅" : "❌"}</td>
            <td>${usuario.accesoJornadas ? "✅" : "❌"}</td>
            <td>${usuario.accessoTarifas ? "✅" : "❌"}</td>
            <td>${usuario.accessoSedes ? "✅" : "❌"}</td>
            <td class="acciones">
                <button class="btn-editar" onclick="abrirModalEditarUsuario(${index})">Editar</button>
                <button class="btn-eliminar" onclick="eliminarUsuario(${index})">Eliminar</button>
            </td>
        </tr>`;
        tbody.innerHTML += fila;
    });
}


function validarNumero(input) {
    input.value = input.value.replace(/[^0-9]/g, ''); // Eliminar caracteres no numéricos
}

function validarFechaNacimiento(input) {
    const fechaNacimiento = new Date(input.value);
    const hoy = new Date();
    const edad = hoy.getFullYear() - fechaNacimiento.getFullYear();

    // Verificar si la persona es mayor de 18 años
    if (edad < 18 || (edad === 18 && hoy < new Date(hoy.getFullYear(), fechaNacimiento.getMonth(), fechaNacimiento.getDate()))) {
        Swal.fire("Error", "El trabajador debe ser mayor de 18 años", "error");
        input.value = ""; // Limpiar el campo si no es válido
    }
}

/*EDITAR*/
function abrirModalEditarTrabajador(index) {
    let trabajador = trabajadores[index];
    document.getElementById("editarTrabajadorId").value = index;

    // Cargar la foto del trabajador si está disponible
    const fotoTrabajadorPreview = document.getElementById("editarFotoTrabajadorPreview");
    if (trabajador.foto) {
        fotoTrabajadorPreview.src = trabajador.foto;
        fotoTrabajadorPreview.style.display = "block";
    } else {
        fotoTrabajadorPreview.style.display = "none";
    }

    // Cargar los demás campos
    document.getElementById("editarNombreApellidos").value = trabajador.nombreApellidos;
    document.getElementById("editarCorreoElectronico").value = trabajador.correoElectronico;
    document.getElementById("editarTipoDocumento").value = trabajador.tipoDocumento;
    document.getElementById("editarNumeroDocumento").value = trabajador.numeroDocumento;
    document.getElementById("editarFechaNacimiento").value = trabajador.fechaNacimiento;
    document.getElementById("editarRh").value = trabajador.rh;
    document.getElementById("editarGenero").value = trabajador.genero;
    document.getElementById("editarCiudad").value = trabajador.ciudad;
    document.getElementById("editarBarrioResidencia").value = trabajador.barrioResidencia;
    document.getElementById("editarDireccionResidencia").value = trabajador.direccionResidencia;
    document.getElementById("editarTelefonoContacto").value = trabajador.telefonoContacto;
    document.getElementById("editarTelefonoEmergencia").value = trabajador.telefonoEmergencia;
    document.getElementById("editarEstadoCivil").value = trabajador.estadoCivil;
    document.getElementById("editarNumeroHijos").value = trabajador.numeroHijos;
    document.getElementById("editarEdadHijos").value = trabajador.edadHijos;
    document.getElementById("editarArl").value = trabajador.arl;
    document.getElementById("editarEps").value = trabajador.eps;
    document.getElementById("editarPension").value = trabajador.pension;
    document.getElementById("editarCesantias").value = trabajador.cesantias;
    document.getElementById("editarTituloObtenido").value = trabajador.tituloObtenido;
    document.getElementById("editarInstitucion").value = trabajador.institucion;
    document.getElementById("editarCiudadAcademica").value = trabajador.ciudadAcademica;
    document.getElementById("editarUltimoGrado").value = trabajador.ultimoGrado;
    document.getElementById("editarAnioCulminado").value = trabajador.anioCulminado;
    document.getElementById("editarUltimaExperiencia").value = trabajador.ultimaExperiencia;
    document.getElementById("editarEmpresa").value = trabajador.empresa;
    document.getElementById("editarCargo").value = trabajador.cargo;
    document.getElementById("editarFechaIngresoLaboral").value = trabajador.fechaIngresoLaboral;
    document.getElementById("editarFechaRetiroLaboral").value = trabajador.fechaRetiroLaboral;
    document.getElementById("editarTelefonoLaboral").value = trabajador.telefonoLaboral;
    document.getElementById("editarParentesco").value = trabajador.parentesco;
    document.getElementById("editarNombreFamiliar").value = trabajador.nombreFamiliar;
    document.getElementById("editarTelefonoFamiliar").value = trabajador.telefonoFamiliar;
    document.getElementById("editarModcontrato").value = trabajador.Modcontrato;
    document.getElementById("editarCapacitacionesRecibidas").value = trabajador.capacitacionesRecibidas;
    document.getElementById("editarDocrecibidos").value = trabajador.Docrecibidos;
    document.getElementById("editarTipoCuenta").value = trabajador.tipoCuenta;
    document.getElementById("editarBanco").value = trabajador.banco;
    document.getElementById("editarTipoDocumentoTitular").value = trabajador.tipoDocumentoTitular;
    document.getElementById("editarNombreTitular").value = trabajador.nombreTitular;
    document.getElementById("editarNumeroDocumentoTitular").value = trabajador.numeroDocumentoTitular;
    document.getElementById("editarNumeroCuenta").value = trabajador.numeroCuenta;

    // Mostrar el modal
    document.getElementById("modalEditarTrabajador").style.display = "flex";
}


// Manejar la subida de la foto en el modal de edición
document.getElementById("fotoTrabajador").addEventListener("change", function () {
    const archivo = this.files[0];
    if (archivo) {
        const lector = new FileReader();
        lector.onload = function (e) {
            document.getElementById("fotoTrabajadorPreview").src = e.target.result;
            document.getElementById("fotoTrabajadorPreview").style.display = "block";
        };
        lector.readAsDataURL(archivo);
    }
});
document.getElementById("editarFotoTrabajador").addEventListener("change", function () {
    const archivo = this.files[0];
    if (archivo) {
        const lector = new FileReader();
        lector.onload = function (e) {
            document.getElementById("editarFotoTrabajadorPreview").src = e.target.result;
            document.getElementById("editarFotoTrabajadorPreview").style.display = "block";
        };
        lector.readAsDataURL(archivo);
    }
});

document.getElementById("editarTrabajadorForm").addEventListener("submit", function(event) {
    event.preventDefault();
    let index = document.getElementById("editarTrabajadorId").value;
    let trabajador = trabajadores[index];

    // Actualizar todos los campos
    trabajador.nombreApellidos = document.getElementById("editarNombreApellidos").value;
    trabajador.correoElectronico = document.getElementById("editarCorreoElectronico").value;
    trabajador.tipoDocumento = document.getElementById("editarTipoDocumento").value;
    trabajador.numeroDocumento = document.getElementById("editarNumeroDocumento").value;
    trabajador.fechaNacimiento = document.getElementById("editarFechaNacimiento").value;
    trabajador.rh = document.getElementById("editarRh").value;
    trabajador.genero = document.getElementById("editarGenero").value;
    trabajador.ciudad = document.getElementById("editarCiudad").value;
    trabajador.barrioResidencia = document.getElementById("editarBarrioResidencia").value;
    trabajador.direccionResidencia = document.getElementById("editarDireccionResidencia").value;
    trabajador.telefonoContacto = document.getElementById("editarTelefonoContacto").value;
    trabajador.telefonoEmergencia = document.getElementById("editarTelefonoEmergencia").value;
    trabajador.estadoCivil = document.getElementById("editarEstadoCivil").value;
    trabajador.numeroHijos = document.getElementById("editarNumeroHijos").value;
    trabajador.edadHijos = document.getElementById("editarEdadHijos").value;
    trabajador.arl = document.getElementById("editarArl").value;
    trabajador.eps = document.getElementById("editarEps").value;
    trabajador.pension = document.getElementById("editarPension").value;
    trabajador.cesantias = document.getElementById("editarCesantias").value;
    trabajador.tituloObtenido = document.getElementById("editarTituloObtenido").value;
    trabajador.institucion = document.getElementById("editarInstitucion").value;
    trabajador.ciudadAcademica = document.getElementById("editarCiudadAcademica").value;
    trabajador.ultimoGrado = document.getElementById("editarUltimoGrado").value;
    trabajador.anioCulminado = document.getElementById("editarAnioCulminado").value;
    trabajador.ultimaExperiencia = document.getElementById("editarUltimaExperiencia").value;
    trabajador.empresa = document.getElementById("editarEmpresa").value;
    trabajador.cargo = document.getElementById("editarCargo").value;
    trabajador.fechaIngresoLaboral = document.getElementById("editarFechaIngresoLaboral").value;
    trabajador.fechaRetiroLaboral = document.getElementById("editarFechaRetiroLaboral").value;
    trabajador.telefonoLaboral = document.getElementById("editarTelefonoLaboral").value;
    trabajador.parentesco = document.getElementById("editarParentesco").value;
    trabajador.nombreFamiliar = document.getElementById("editarNombreFamiliar").value;
    trabajador.telefonoFamiliar = document.getElementById("editarTelefonoFamiliar").value;
    trabajador.Modcontrato = document.getElementById("editarModcontrato").value;
    trabajador.capacitacionesRecibidas = document.getElementById("editarCapacitacionesRecibidas").value;
    trabajador.Docrecibidos = document.getElementById("editarDocrecibidos").value;
    trabajador.tipoCuenta = document.getElementById("editarTipoCuenta").value;
    trabajador.banco = document.getElementById("editarBanco").value;
    trabajador.tipoDocumentoTitular = document.getElementById("editarTipoDocumentoTitular").value;
    trabajador.nombreTitular = document.getElementById("editarNombreTitular").value;
    trabajador.numeroDocumentoTitular = document.getElementById("editarNumeroDocumentoTitular").value;
    trabajador.numeroCuenta = document.getElementById("editarNumeroCuenta").value;

    // Guardar cambios en localStorage
    localStorage.setItem("trabajadores", JSON.stringify(trabajadores));

    // Actualizar la lista de trabajadores
    actualizarListaTrabajadores();

    // Mostrar mensaje de éxito
    Swal.fire("Éxito", "Trabajador actualizado correctamente", "success");

    // Cerrar el modal
    cerrarModalEditarTrabajador();
});
function eliminarJornada(index) {
    Swal.fire({
        title: '¿Eliminar registro?',
        text: "Esta acción no se puede deshacer",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Sí, eliminar!'
    }).then((result) => {
        if (result.isConfirmed) {
            registrosJornadas.splice(index, 1);
            localStorage.setItem("registrosJornadas", JSON.stringify(registrosJornadas));
            mostrarRegistrosJornadas();
            Swal.fire('Eliminado!', 'El registro fue eliminado.', 'success');
        }
    });
}


function editarJornada(index) {
    const jornada = registrosJornadas[index];
    // Llenar formulario con los datos
    document.getElementById("nombreTrabajadorJornada").value = jornada.trabajador;
    document.getElementById("sede").value = jornada.sede;
    document.getElementById("operacion").value = jornada.operacion;
    document.getElementById("fechaJornada").value = jornada.fecha;
    document.getElementById("horaInicio").value = jornada.horaInicio;
    document.getElementById("horaFin").value = jornada.horaFin;
    document.getElementById("tipoJornada").value = jornada.tipoJornada;
    
    // Eliminar el registro antiguo
    registrosJornadas.splice(index, 1);
    
    // Abrir modal
    abrirModalJornada();
}


function cerrarModalEditarTrabajador() {
    document.getElementById("modalEditarTrabajador").style.display = "none";
}
        // Mostrar secciones
function mostrarSeccion(id) {
    document.querySelectorAll('.container').forEach(seccion => seccion.style.display = 'none');
    document.getElementById(id).style.display = 'block';

    if (id === 'sedes') {
        mostrarSedes(); // Llamar directamente la función
        actualizarFiltroSedes(); // Actualizar filtros si es necesario
    }
}

        // Mostrar subsecciones
function mostrarSubseccion(id) {
    document.querySelectorAll('.subseccion').forEach(subseccion => {
        subseccion.style.display = 'none'; // Oculta todas las subsecciones
    });
    document.getElementById(id).style.display = 'block'; // Muestra la subsección "usuarios"
    if (id === 'usuarios') mostrarUsuarios(); // Llama a la función clave
}

function mostrarUsuarios() {
    const tbody = document.getElementById("tablaUsuarios");
    tbody.innerHTML = ""; // Limpia la tabla
    
    // Obtiene usuarios del localStorage
    const usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
    
    usuarios.forEach((usuario, index) => {
        const fila = `
            <tr>
                <td>${usuario.nombre}</td>
                <td>${usuario.accesoTrabajadores ? "✅" : "❌"}</td>
                <td>${usuario.accesoJornadas ? "✅" : "❌"}</td>
                <td>${usuario.accessoTarifas ? "✅" : "❌"}</td>
                <td>${usuario.accessoSedes ? "✅" : "❌"}</td>
                <td class="acciones">
                    <button class="btn-editar" onclick="abrirModalEditarUsuario(${index})">Editar</button>
                    <button class="btn-eliminar" onclick="eliminarUsuario(${index})">Eliminar</button>
                </td>
            </tr>
        `;
        tbody.innerHTML += fila;
    });
}

	//Función Generar Nomina
document.getElementById("nominaForm").addEventListener("submit", function(event) {
    event.preventDefault();
    let periodo = document.getElementById("periodoNomina").value;
    // Lógica para generar la nómina
    let resultado = `Nómina generada para el período: ${periodo}`;
    document.getElementById("resultadoNomina").textContent = resultado;
});

	//Función Generar Factura

document.getElementById("facturacionForm").addEventListener("submit", function(event) {
    event.preventDefault();
    let cliente = document.getElementById("clienteFacturacion").value;
    let monto = document.getElementById("montoFacturacion").value;
    let fecha = document.getElementById("fechaFacturacion").value;
    // Lógica para generar la factura
    let resultado = `Factura generada para ${cliente} por un monto de $${monto} el ${fecha}`;
    document.getElementById("resultadoFacturacion").textContent = resultado;
});

	//Función Generar Informe

	function generarInforme() {
    // Lógica para generar el informe
    let resultado = "Informe generado con éxito.";
    document.getElementById("resultadoInforme").textContent = resultado;
}

        // Funciones para abrir y cerrar modales
        function abrirModalJornada() {
            actualizarFiltroTrabajadores();
            actualizarFiltroSedes();
            document.getElementById("modalJornadas").style.display = "flex";
        }
        function cerrarModalJornada() {
            document.getElementById("modalJornadas").style.display = "none";
        }

function cerrarModalMasInformacion() {
    document.getElementById("modalMasInformacion").style.display = "none";
}
       

function abrirModalEditarJornada(index) {
    let registro = registrosJornadas[index];
    document.getElementById("editarJornadaId").value = index;

    // Cargar datos en los campos (solo lectura para nombre, sede y operación)
    document.getElementById("editarNombreTrabajadorJornada").value = registro.nombre;
    document.getElementById("editarSede").value = registro.sede;
    document.getElementById("editarOperacion").value = registro.operacion;

    // Permitir edición solo de fecha, hora de inicio y hora de fin
    document.getElementById("editarFechaJornada").value = registro.fecha;
    document.getElementById("editarHoraInicio").value = registro.horaInicio;
    document.getElementById("editarHoraFin").value = registro.horaFin;

    // Mostrar el modal
    document.getElementById("modalEditarJornada").style.display = "flex";
}

//Guardar cambios jornadas

document.getElementById("editarJornadaForm").addEventListener("submit", function(event) {
    event.preventDefault();
    let index = document.getElementById("editarJornadaId").value;
    let registro = registrosJornadas[index];

    // Actualizar solo los campos editables
    registro.fecha = document.getElementById("editarFechaJornada").value;
    registro.horaInicio = document.getElementById("editarHoraInicio").value;
    registro.horaFin = document.getElementById("editarHoraFin").value;

    // Recalcular horas trabajadas y valor total
    registro.horasTrabajadas = calcularHoras(registro.horaInicio, registro.horaFin);
    registro.horasExtras = Math.max(0, registro.horasTrabajadas - 8);

    // Buscar tarifa para la sede
    let tarifaSede = tarifas.find(t => t.sede === registro.sede);
    if (tarifaSede) {
        if (registro.tipoJornada === "diurna") {
            registro.valorTotal = (Math.min(registro.horasTrabajadas, 8) * tarifaSede.diurna) + (registro.horasExtras * tarifaSede.extraDiurna);
        } else if (registro.tipoJornada === "nocturna") {
            registro.valorTotal = (Math.min(registro.horasTrabajadas, 8) * tarifaSede.nocturna) + (registro.horasExtras * tarifaSede.extraNocturna);
        } else if (registro.tipoJornada === "dominical") {
            registro.valorTotal = registro.horasTrabajadas * tarifaSede.dominical;
        }
    }

    // Guardar cambios en localStorage
    localStorage.setItem("registrosJornadas", JSON.stringify(registrosJornadas));

    // Actualizar la tabla de jornadas
    mostrarRegistrosJornadas();

    // Cerrar el modal
    Swal.fire("Éxito", "Jornada actualizada correctamente", "success");
    cerrarModalEditarJornada();
});
       

 function cerrarModalEditarJornada() {
            document.getElementById("modalEditarJornada").style.display = "none";
        }
        function abrirModalTrabajador() {
            document.getElementById("modalTrabajadores").style.display = "flex";
        }
// Corregir la llamada incorrecta
function cerrarModalTrabajador() {
    document.getElementById("modalTrabajadores").style.display = "none";
}
        function abrirModalTarifa() {
            actualizarFiltroSedes();
            document.getElementById("modalTarifas").style.display = "flex";
        }
        function cerrarModalTarifa() {
            document.getElementById("modalTarifas").style.display = "none";
        }
        function abrirModalSede() {
            document.getElementById("modalSedes").style.display = "flex";
        }
        function cerrarModalSede() {
            document.getElementById("modalSedes").style.display = "none";
        }
        function abrirModalUsuario() {
            document.getElementById("modalUsuarios").style.display = "flex";
        }
        function cerrarModalUsuario() {
            document.getElementById("modalUsuarios").style.display = "none";
        }

function abrirModalEditarUsuario(index) {
    let usuario = usuarios[index];
    document.getElementById("editarUsuarioId").value = index;
    document.getElementById("editarNombreUsuario").value = usuario.nombre;
    document.getElementById("editarAccesoTrabajadores").checked = usuario.accesoTrabajadores;
    document.getElementById("editarAccesoJornadas").checked = usuario.accesoJornadas;
    document.getElementById("editarAccessoTarifas").checked = usuario.accessoTarifas;
    document.getElementById("editarAccessoSedes").checked = usuario.accessoSedes;
    document.getElementById("modalEditarUsuario").style.display = "flex";


            document.getElementById("modalEditarUsuario").style.display = "flex";
        }
        function cerrarModalEditarUsuario() {
            document.getElementById("modalEditarUsuario").style.display = "none";
        }

        // Registrar usuario
	document.getElementById("usuariosForm").addEventListener("submit", function(event) {
   	 event.preventDefault();
   	 let nombreUsuario = document.getElementById("nombreUsuario").value;
   	 let contrasenaUsuario = document.getElementById("contrasenaUsuario").value;
   	 let accesoTrabajadores = document.getElementById("accesoTrabajadores").checked;
   	 let accesoJornadas = document.getElementById("accesoJornadas").checked;
   	 let accessoTarifas = document.getElementById("accessoTarifas").checked;
   	 let accessoSedes = document.getElementById("accessoSedes").checked;

if (usuarios.some(u => u.nombre === nombreUsuario)) {
    Swal.fire("Error", "El nombre de usuario ya existe", "error");
    return;
}
function validarEdad(input) {
    const fechaNacimiento = new Date(input.value);
    const hoy = new Date();
    let edad = hoy.getFullYear() - fechaNacimiento.getFullYear();
    const mes = hoy.getMonth() - fechaNacimiento.getMonth();
    if (mes < 0 || (mes === 0 && hoy.getDate() < fechaNacimiento.getDate())) {
        edad--;
    }
    if (edad < 18) {
        Swal.fire("Error", "El trabajador debe ser mayor de 18 años", "error");
        input.value = "";
        return false;
    }
    return true;
}

function calcularEdad(fechaNacimiento) {
    const hoy = new Date();
    const fechaNac = new Date(fechaNacimiento);
    let edad = hoy.getFullYear() - fechaNac.getFullYear();
    const mes = hoy.getMonth() - fechaNac.getMonth();
    if (mes < 0 || (mes === 0 && hoy.getDate() < fechaNac.getDate())) {
        edad--;
    }
    return edad;
}

// Obtener el campo de subida de foto
const inputFoto = document.getElementById("fotoTrabajador");

// Mostrar vista previa de la imagen
inputFoto.addEventListener("change", function () {
    const archivo = this.files[0]; // Obtener el archivo seleccionado
    if (archivo) {
        const lector = new FileReader(); // Crear un lector de archivos
        lector.onload = function (e) {
            // Mostrar la imagen en un elemento <img>
            const vistaPrevia = document.createElement("img");
            vistaPrevia.src = e.target.result; // Asignar la imagen cargada
            vistaPrevia.style.maxWidth = "100px"; // Tamaño máximo de la vista previa
            vistaPrevia.style.marginTop = "10px"; // Espacio superior
            document.getElementById("registroForm").appendChild(vistaPrevia); // Agregar al formulario
        };
        lector.readAsDataURL(archivo); // Leer el archivo como URL
    }
});
function registrarTrabajador() {


    const camposObligatorios = [
        "nombreApellidos", "correoElectronico", "tipoDocumento", 
        "numeroDocumento", "fechaNacimiento", "rh", "genero", 
        "ciudad", "barrioResidencia", "direccionResidencia", 
        "telefonoContacto", "telefonoEmergencia", "estadoCivil", 
        "numeroHijos", "arl", "eps", "pension", "cesantias", 
        "tituloObtenido", "institucion", "ciudadAcademica", 
        "ultimoGrado", "anioCulminado", "empresa", "cargo"
    ];

    for (let campo of camposObligatorios) {
        if (!document.getElementById(campo).value) {
            Swal.fire("Error", "Todos los campos son obligatorios", "error");
            return;
        }
    }

    // Obtener el número de documento del formulario
    const numeroDocumento = document.getElementById("numeroDocumento").value;

    // Verificar si ya existe un trabajador con el mismo número de documento
    const existeTrabajador = trabajadores.some(trabajador => trabajador.numeroDocumento === numeroDocumento);

    if (existeTrabajador) {
        Swal.fire("Error", "Ya existe un trabajador con este número de documento", "error");
        return; // Detener la ejecución si el número de documento ya existe
    }



    const fechaNacimientoInput = document.getElementById("fechaNacimiento");

    
    // Validar la edad antes de continuar
    if (!validarEdad(fechaNacimientoInput)) {
        return; // Detener la ejecución si la validación falla
    }

    // Obtener la fecha de nacimiento del formulario
    const fechaNacimiento = document.getElementById("fechaNacimiento").value;

    // Calcular la edad
    const edad = calcularEdad(fechaNacimiento);

    // Verificar si la edad es menor a 18 años
    if (edad < 18) {
        Swal.fire("Error", "El trabajador debe ser mayor de 18 años", "error");
        return; // Detener la ejecución si la edad es menor a 18
    }


let capacitacionesRecibidas = {
        capacitacion1: document.getElementById("capacitacion1").checked,
        capacitacion2: document.getElementById("capacitacion2").checked,
        capacitacion3: document.getElementById("capacitacion3").checked,
        capacitacion4: document.getElementById("capacitacion4").checked,
        capacitacion5: document.getElementById("capacitacion5").checked,
        capacitacion6: document.getElementById("capacitacion6").checked,
        capacitacion7: document.getElementById("capacitacion7").checked,
        capacitacion8: document.getElementById("capacitacion8").checked,
        capacitacion9: document.getElementById("capacitacion9").checked,
        capacitacion10: document.getElementById("capacitacion10").checked,
    };



let documentosRecibidos = {
        documento1: document.getElementById("documento1").checked,
        documento2: document.getElementById("documento2").checked,
        documento3: document.getElementById("documento3").checked,
        documento4: document.getElementById("documento4").checked,
        documento5: document.getElementById("documento5").checked,
        documento6: document.getElementById("documento6").checked,
        documento7: document.getElementById("documento7").checked,
        documento8: document.getElementById("documento8").checked,
        documento9: document.getElementById("documento9").checked,
        documento10: document.getElementById("documento10").checked,
        documento11: document.getElementById("documento11").checked,
        documento12: document.getElementById("documento12").checked,
        documento13: document.getElementById("documento13").checked,
        documento14: document.getElementById("documento14").checked
    };

    const fotoTrabajador = document.getElementById("fotoTrabajador").files[0];

    if (fotoTrabajador) {
        const reader = new FileReader();
        reader.onload = function (e) {
            const fotoBase64 = e.target.result;

            // Generar un ID único para el trabajador
            const idUnico = generarIdUnico();

            // Crear el objeto trabajador con la foto en base64
            let trabajador = {

                id: idUnico,
		foto: fotoBase64, // Guardar la foto en base64
                nombreApellidos: document.getElementById("nombreApellidos").value,
                correoElectronico: document.getElementById("correoElectronico").value,
                tipoDocumento: document.getElementById("tipoDocumento").value,
                numeroDocumento: document.getElementById("numeroDocumento").value,
                fechaNacimiento: document.getElementById("fechaNacimiento").value,
                rh: document.getElementById("rh").value,
                genero: document.getElementById("genero").value,
                ciudad: document.getElementById("ciudad").value,
                barrioResidencia: document.getElementById("barrioResidencia").value,
                direccionResidencia: document.getElementById("direccionResidencia").value,
                telefonoContacto: document.getElementById("telefonoContacto").value,
                telefonoEmergencia: document.getElementById("telefonoEmergencia").value,
                estadoCivil: document.getElementById("estadoCivil").value,
                numeroHijos: document.getElementById("numeroHijos").value,
                edadHijos: document.getElementById("edadHijos").value,
                arl: document.getElementById("arl").value,
                eps: document.getElementById("eps").value,
                pension: document.getElementById("pension").value,
                cesantias: document.getElementById("cesantias").value,
                tituloObtenido: document.getElementById("tituloObtenido").value,
                institucion: document.getElementById("institucion").value,
                ciudadAcademica: document.getElementById("ciudadAcademica").value,
                ultimoGrado: document.getElementById("ultimoGrado").value,
                anioCulminado: document.getElementById("anioCulminado").value,
                empresa: document.getElementById("empresa").value,
                cargo: document.getElementById("cargo").value,
                fechaIngresoLaboral: document.getElementById("fechaIngresoLaboral").value,
                fechaRetiroLaboral: document.getElementById("fechaRetiroLaboral").value,
                telefonoLaboral: document.getElementById("telefonoLaboral").value,
                parentesco: document.getElementById("parentesco").value,
                nombreFamiliar: document.getElementById("nombreFamiliar").value,
                telefonoFamiliar: document.getElementById("telefonoFamiliar").value,
                Modcontrato: document.getElementById("Modcontrato").value,
    capacitacionesRecibidas: {}, // Inicializar como objeto vacío
    documentosRecibidos: {},      // Inicializar como objeto vacío
        tipoCuenta: document.getElementById("TipoCuenta").value,
        banco: document.getElementById("Banco").value,
        tipoDocumentoTitular: document.getElementById("tipoDocumentoTitular").value,
        nombreTitular: document.getElementById("nombreTitular").value,
        numeroDocumentoTitular: document.getElementById("numeroDocumentoTitular").value,
        numeroCuenta: document.getElementById("numeroCuenta").value
            };

            // Guardar el trabajador en el localStorage
            trabajadores.push(trabajador);
            localStorage.setItem("trabajadores", JSON.stringify(trabajadores));

            // Mostrar mensaje de éxito
            Swal.fire("Éxito", "Trabajador registrado correctamente", "success");

            // Limpiar el formulario y cerrar el modal
            document.getElementById("registroForm").reset();
            cerrarModalTrabajador();

            // Actualizar la lista de trabajadores
            actualizarListaTrabajadores();
        };
        reader.readAsDataURL(fotoTrabajador);
    } else {
        Swal.fire("Error", "Debes subir una foto del trabajador", "error");
    }
}


const express = require("express");
const multer = require("multer"); // Middleware para manejar la carga de archivos
const app = express();

// Configurar multer para guardar las imágenes en la carpeta "uploads"
const upload = multer({ dest: "uploads/" });

// Ruta para manejar el registro de trabajadores
app.post("/ruta-del-backend", upload.single("fotoTrabajador"), (req, res) => {
    const datosTrabajador = req.body; // Datos del formulario
    const fotoTrabajador = req.file; // Archivo de la foto

    console.log("Datos del trabajador:", datosTrabajador);
    console.log("Foto del trabajador:", fotoTrabajador);

    // Aquí puedes guardar los datos en la base de datos
    // ...

    res.json({ mensaje: "Trabajador registrado correctamente" });
});

app.listen(3000, () => {
    console.log("Servidor escuchando en el puerto 3000");
});

            // Si el usuario es Gerente, asignar todos los permisos
            if (nombreUsuario === "Gerente") {
                accesoTrabajadores = true;
                accesoJornadas = true;
                accessoTarifas = true;
                accessoSedes = true;
            }

    let usuario = {
        nombre: nombreUsuario,
        contrasena: contrasenaUsuario,
        accesoTrabajadores,
        accesoJornadas,
        accessoTarifas,
        accessoSedes
    };
    usuarios.push(usuario);
    localStorage.setItem("usuarios", JSON.stringify(usuarios));
    mostrarUsuarios();
    Swal.fire("Éxito", "Usuario registrado correctamente", "success");
    this.reset();
    cerrarModalUsuario();
});

        // Editar usuario
document.getElementById("editarUsuarioForm").addEventListener("submit", function(event) {
    event.preventDefault();
    let index = document.getElementById("editarUsuarioId").value;
    let usuario = usuarios[index];
    usuario.accesoTrabajadores = document.getElementById("editarAccesoTrabajadores").checked;
    usuario.accesoJornadas = document.getElementById("editarAccesoJornadas").checked;
    usuario.accessoTarifas = document.getElementById("editarAccessoTarifas").checked;
    usuario.accessoSedes = document.getElementById("editarAccessoSedes").checked;
    localStorage.setItem("usuarios", JSON.stringify(usuarios));
    mostrarUsuarios();
    Swal.fire("Éxito", "Usuario actualizado correctamente", "success");
    cerrarModalEditarUsuario();
});

        // Mostrar usuarios
function mostrarUsuarios() {
    let tbody = document.getElementById("tablaUsuarios");
    tbody.innerHTML = "";
    usuarios.forEach((usuario, index) => {
        let fila = `<tr>
            <td>${usuario.nombre}</td>
            <td>${usuario.accesoTrabajadores ? "Sí" : "No"}</td>
            <td>${usuario.accesoJornadas ? "Sí" : "No"}</td>
            <td>${usuario.accessoTarifas ? "Sí" : "No"}</td>
            <td>${usuario.accessoSedes ? "Sí" : "No"}</td>
            <td>
                <button class="btn-editar" onclick="abrirModalEditarUsuario(${index})">Editar</button>
                <button class="btn-eliminar" onclick="eliminarUsuario(${index})">Eliminar</button>
            </td>
        </tr>`;
        tbody.innerHTML += fila;
    });
}
        document.addEventListener("DOMContentLoaded", mostrarUsuarios);

        // Eliminar usuario
function eliminarUsuario(index) {
    usuarios.splice(index, 1);
    localStorage.setItem("usuarios", JSON.stringify(usuarios));
    mostrarUsuarios();
    Swal.fire("Éxito", "Usuario eliminado correctamente", "success");
}


document.addEventListener("DOMContentLoaded", function () {
    const inputFoto = document.getElementById("fotoTrabajador");

    inputFoto.addEventListener("change", function () {
        const archivo = this.files[0];
        if (archivo) {
            const reader = new FileReader();
            reader.onload = function (e) {
                // Asegúrate de que el elemento exista antes de acceder a él
                const nombreApellidos = document.getElementById("nombreApellidos");
                if (nombreApellidos) {
                    nombreApellidos.value = ""; // Ejemplo de acceso al valor
                } else {
                    console.error("El elemento 'nombreApellidos' no existe en el DOM.");
                }
            };
            reader.readAsDataURL(archivo);
        }
    });
});


document.addEventListener("DOMContentLoaded", function () {
    let usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];

    // Verificar si el usuario Gerente ya existe
    let gerenteExistente = usuarios.find(u => u.nombre === "Gerente");

    if (!gerenteExistente) {
        let usuarioGerente = {
            nombre: "Gerente",
            contrasena: "AMALOGISTICA",
            accesoTrabajadores: true,
            accesoJornadas: true,
            accessoTarifas: true,
            accessoSedes: true
        };
        usuarios.push(usuarioGerente);
        localStorage.setItem("usuarios", JSON.stringify(usuarios));
    }

    mostrarUsuarios();
});

document.addEventListener("DOMContentLoaded", function () {
    let capacitacionesRecibidas = {
        capacitacion1: document.getElementById("capacitacion1").checked,
        capacitacion2: document.getElementById("capacitacion2").checked,
        capacitacion3: document.getElementById("capacitacion3").checked,
        capacitacion4: document.getElementById("capacitacion4").checked,
        capacitacion5: document.getElementById("capacitacion5").checked,
        capacitacion6: document.getElementById("capacitacion6").checked,
        capacitacion7: document.getElementById("capacitacion7").checked,
        capacitacion8: document.getElementById("capacitacion8").checked,
        capacitacion9: document.getElementById("capacitacion9").checked,
        capacitacion10: document.getElementById("capacitacion10").checked,
    };

    console.log("Capacitaciones Recibidas:", capacitacionesRecibidas);
});

document.addEventListener("DOMContentLoaded", function () {
    const tarifasForm = document.getElementById("tarifasForm");
    if (tarifasForm) {
        tarifasForm.addEventListener("submit", function (event) {
            event.preventDefault();
            // Lógica para registrar la tarifa
        });
    } else {
        console.error("El formulario de tarifas no existe en el DOM.");
    }
});

        // Descargar registro de jornadas en Excel
        function descargarExcel() {
            const datos = registrosJornadas.map(registro => ({
                Nombre: registro.nombre,
                Sede: registro.sede,
                Línea: registro.linea,
                Fecha: registro.fecha,
                "Hora Inicio": registro.horaInicio,
                "Hora Fin": registro.horaFin,
                "Horas Trabajadas": registro.horasTrabajadas,
                "Horas Extras": registro.horasExtras,
                "Tipo de Jornada": registro.tipoJornada,
                "Valor Total": registro.valorTotal
            }));

            const hoja = XLSX.utils.json_to_sheet(datos);
            const libro = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(libro, hoja, "Jornadas");
            XLSX.writeFile(libro, "registro_jornadas.xlsx");
        }

// Actualizar lista de trabajadores en el modal de jornadas
        function actualizarFiltroTrabajadores() {
            let select = document.getElementById("nombreTrabajadorJornada");
            select.innerHTML = `<option value="">Seleccione un trabajador</option>`;
            trabajadores.forEach(trabajador => {
                let option = new Option(`${trabajador.nombre} - ${trabajador.numeroDocumento}`, trabajador.numeroDocumento);
                select.appendChild(option);
            });
        }

        // Actualizar lista de sedes en los modales
function actualizarFiltroSedes() {
    const sedesUnicas = Array.from(new Set(sedes.map(sede => 
        `${sede.ciudad} - ${sede.cliente}`
    )));
    
    document.querySelectorAll('#filtroSede, #sedeTarifa, #sede').forEach(select => {
        select.innerHTML = '<option value="">Seleccione sede</option>';
        sedesUnicas.forEach(combinacion => {
            const [ciudad, cliente] = combinacion.split(' - ');
            const option = document.createElement('option');
            option.value = combinacion;
            option.textContent = combinacion;
            select.appendChild(option);
        });
    });
}

function validarCombinacionEnTiempoReal() {
    const ciudad = document.getElementById("ciudadSede").value.trim().toLowerCase();
    const cliente = document.getElementById("clienteSede").value.trim().toLowerCase();
    const feedback = document.getElementById("feedbackCombinacion");
    
    const existe = sedes.some(sede => 
        sede.ciudad.toLowerCase() === ciudad && 
        sede.cliente.toLowerCase() === cliente
    );
    
    if (existe) {
        feedback.textContent = "⚠️ Combinación ya registrada";
        feedback.style.color = "#dc3545";
        return false;
    }
    feedback.textContent = "✅ Combinación válida";
    feedback.style.color = "#28a745";
    return true;
}


        // Cargar líneas según la sede seleccionada
function cargarLineas() {
    let sedeSeleccionada = document.getElementById("sede").value;
    let selectLinea = document.getElementById("linea");
    selectLinea.innerHTML = `<option value="">Seleccione una línea</option>`;
    if (sedeSeleccionada) {
        let sede = sedes.find(s => s.ciudad === sedeSeleccionada);
        if (sede) {
            let option = new Option(sede.operacion, sede.operacion);
            selectLinea.appendChild(option);
        }
    }
}

        // Cargar tarifas existentes para la sede seleccionada
function cargarTarifas() {
    let sedeSeleccionada = document.getElementById("sedeTarifa").value;
    let operacionSeleccionada = document.getElementById("operacionTarifa").value;
    if (sedeSeleccionada && operacionSeleccionada) {
        let tarifaExistente = tarifas.find(t => t.sede === sedeSeleccionada && t.operacion === operacionSeleccionada);
        if (tarifaExistente) {
            // Tarifas de pago
            document.getElementById("tarifaDiurnaPago").value = tarifaExistente.tarifasPago.diurna;
            document.getElementById("tarifaExtraDiurnaPago").value = tarifaExistente.tarifasPago.extraDiurna;
            document.getElementById("tarifaNocturnaPago").value = tarifaExistente.tarifasPago.nocturna;
            document.getElementById("tarifaExtraNocturnaPago").value = tarifaExistente.tarifasPago.extraNocturna;
            document.getElementById("tarifaDominicalPago").value = tarifaExistente.tarifasPago.dominical;

            // Tarifas de cobro
            document.getElementById("tarifaDiurnaCobro").value = tarifaExistente.tarifasCobro.diurna;
            document.getElementById("tarifaExtraDiurnaCobro").value = tarifaExistente.tarifasCobro.extraDiurna;
            document.getElementById("tarifaNocturnaCobro").value = tarifaExistente.tarifasCobro.nocturna;
            document.getElementById("tarifaExtraNocturnaCobro").value = tarifaExistente.tarifasCobro.extraNocturna;
            document.getElementById("tarifaDominicalCobro").value = tarifaExistente.tarifasCobro.dominical;
        } else {
            // Limpiar campos si no existe la tarifa
            document.getElementById("tarifaDiurnaPago").value = "";
            document.getElementById("tarifaExtraDiurnaPago").value = "";
            document.getElementById("tarifaNocturnaPago").value = "";
            document.getElementById("tarifaExtraNocturnaPago").value = "";
            document.getElementById("tarifaDominicalPago").value = "";
            document.getElementById("tarifaDiurnaCobro").value = "";
            document.getElementById("tarifaExtraDiurnaCobro").value = "";
            document.getElementById("tarifaNocturnaCobro").value = "";
            document.getElementById("tarifaExtraNocturnaCobro").value = "";
            document.getElementById("tarifaDominicalCobro").value = "";
        }
    }
}


// Registrar trabajador
document.getElementById("registroForm").addEventListener("submit", function(event) {
    event.preventDefault();

    const fotoTrabajador = document.getElementById("fotoTrabajador").files[0];

    if (fotoTrabajador) {
        const reader = new FileReader();
        reader.onload = function (e) {
            const fotoBase64 = e.target.result; // Convertir la foto a base64

            // Obtener valores de los campos
	    
            const nombreApellidos = document.getElementById("nombreApellidos").value;
            const correoElectronico = document.getElementById("correoElectronico").value;
            const tipoDocumento = document.getElementById("tipoDocumento").value;
            const numeroDocumento = document.getElementById("numeroDocumento").value;
            const fechaNacimiento = document.getElementById("fechaNacimiento").value;
            const rh = document.getElementById("rh").value;
            const genero = document.getElementById("genero").value;
            const ciudad = document.getElementById("ciudad").value;
            const barrioResidencia = document.getElementById("barrioResidencia").value;
            const direccionResidencia = document.getElementById("direccionResidencia").value;
            const telefonoContacto = document.getElementById("telefonoContacto").value;
            const telefonoEmergencia = document.getElementById("telefonoEmergencia").value;
            const estadoCivil = document.getElementById("estadoCivil").value;
            const numeroHijos = document.getElementById("numeroHijos").value;
            const edadHijos = document.getElementById("edadHijos").value;
            const arl = document.getElementById("arl").value;
            const eps = document.getElementById("eps").value;
            const pension = document.getElementById("pension").value;
            const cesantias = document.getElementById("cesantias").value;
            const tituloObtenido = document.getElementById("tituloObtenido").value;
            const institucion = document.getElementById("institucion").value;
            const ciudadAcademica = document.getElementById("ciudadAcademica").value;
            const ultimoGrado = document.getElementById("ultimoGrado").value;
            const anioCulminado = document.getElementById("anioCulminado").value;
            const empresa = document.getElementById("empresa").value;
            const cargo = document.getElementById("cargo").value;
            const laborEx = document.getElementById("LaborEx").value;
            const fechaIngresoLaboral = document.getElementById("fechaIngresoLaboral").value;
            const fechaRetiroLaboral = document.getElementById("fechaRetiroLaboral").value;
            const telefonoLaboral = document.getElementById("telefonoLaboral").value;
            const parentesco = document.getElementById("parentesco").value;
            const nombreFamiliar = document.getElementById("nombreFamiliar").value;
            const telefonoFamiliar = document.getElementById("telefonoFamiliar").value;
            const ModContrato = document.getElementById("Modcontrato").value;
            const perfilCargo = document.getElementById("PerfilCargo").value;
	    const tipoCuenta = document.getElementById("TipoCuenta").value; // ID: "TipoCuenta"
	    const banco = document.getElementById("Banco").value; // ID: "Banco"
	    const tipoDocumentoTitular = document.getElementById("tipoDocumentoTitular").value; // ID: "tipoDocumentoTitular"
	    const nombreTitular = document.getElementById("nombreTitular").value; // ID: "nombreTitular"
	    const numeroDocumentoTitular = document.getElementById("numeroDocumentoTitular").value; // ID: "numeroDocumentoTitular"
	    const numeroCuenta = document.getElementById("numeroCuenta").value; // ID: "numeroCuenta" (corregido)

            // Obtener los valores de los checklist
            const capacitacionesRecibidas = Array.from(document.querySelectorAll('input[name="capacitaciones"]:checked')).map(cb => cb.value);
            const documentosRecibidos = Array.from(document.querySelectorAll('input[name="documentos"]:checked')).map(cb => cb.value);

            // Verificar si ya existe un trabajador con el mismo número de documento
            if (trabajadores.some(trabajador => trabajador.numeroDocumento === numeroDocumento)) {
                Swal.fire("Error", "Ya existe un trabajador con este número de documento", "error");
                return;
            }

            // Crear el objeto trabajador con los nuevos campos
            const trabajador = {
                foto: fotoBase64, // Guardar la foto en el objeto trabajador
                nombreApellidos,
                correoElectronico,
                tipoDocumento,
                numeroDocumento,
                fechaNacimiento,
                rh,
                genero,
                ciudad,
                barrioResidencia,
                direccionResidencia,
                telefonoContacto,
                telefonoEmergencia,
                estadoCivil,
                numeroHijos,
                edadHijos,
                arl,
                eps,
                pension,
                cesantias,
                tituloObtenido,
                institucion,
                ciudadAcademica,
                ultimoGrado,
                anioCulminado,
                empresa,
                cargo,
                laborEx,
                fechaIngresoLaboral,
                fechaRetiroLaboral,
                telefonoLaboral,
                parentesco,
                nombreFamiliar,
                telefonoFamiliar,
                Modcontrato,
                perfilCargo,
                capacitacionesRecibidas, // Agregado
                documentosRecibidos, // Agregado
		tipoCuenta: tipoCuenta,
		banco: banco,
		tipoDocumentoTitular: tipoDocumentoTitular,
		nombreTitular: nombreTitular,
		numeroDocumentoTitular: numeroDocumentoTitular,
		numeroCuenta: numeroCuenta
		

            };

            // Guardar el trabajador en el localStorage
            trabajadores.push(trabajador);
            localStorage.setItem("trabajadores", JSON.stringify(trabajadores));

            // Generar un usuario automáticamente
            const usuario = {
                nombre: numeroDocumento, // Usuario es el número de documento
                contrasena: fechaNacimiento.replace(/-/g, ""), // Contraseña es la fecha de nacimiento sin guiones
                accesoTrabajadores: false,
                accesoJornadas: false,
                accessoTarifas: false,
                accessoSedes: false
            };

            // Guardar el usuario en el localStorage
            usuarios.push(usuario);
            localStorage.setItem("usuarios", JSON.stringify(usuarios));

            // Actualizar la lista de trabajadores
            actualizarListaTrabajadores();

            // Mostrar mensaje de éxito
            Swal.fire("Éxito", "Trabajador registrado correctamente", "success");

            // Limpiar el formulario
            document.getElementById("registroForm").reset();

            // Limpiar el formulario y cerrar el modal
            this.reset();
            cerrarModalTrabajador();
        };
        reader.readAsDataURL(fotoTrabajador); // Leer la foto como URL base64
    } else {
        Swal.fire("Error", "Debes subir una foto del trabajador", "error");
    }
});


        // Actualizar lista de trabajadores
function actualizarListaTrabajadores() {
    let tbody = document.getElementById("listaTrabajadores");
    tbody.innerHTML = "";

    trabajadores.forEach((trabajador, index) => {
        if (!trabajador) {
            console.error("Trabajador no definido en el índice:", index);
            return;
        }

        const capacitacionesRecibidas = trabajador.capacitacionesRecibidas || {};
        const documentosRecibidos = trabajador.documentosRecibidos || {};

        const capacitacionesCompletas = Object.values(capacitacionesRecibidas).every(c => c);
        const documentosCompletos = Object.values(documentosRecibidos).every(d => d);

        let estadoCapacitaciones = capacitacionesCompletas ? "✅" : "❌";
        let estadoDocumentos = documentosCompletos ? "✅" : "❌";

        let row = `
            <tr>
                <td>${index + 1}</td>
                <td>${trabajador.nombreApellidos || "No disponible"}</td>
                <td>${trabajador.tipoDocumento || "No disponible"}</td>
                <td>${trabajador.numeroDocumento || "No disponible"}</td>
                <td>
                    <button class="btn-mas-informacion" onclick="mostrarMasInformacion(${index})">Más Información</button>
                </td>
                <td>
                    <button class="btn-editar" onclick="abrirModalEditarTrabajador(${index})">Editar</button>
                    <button class="btn-eliminar" onclick="eliminarTrabajador(${index})">Eliminar</button>
                </td>
            </tr>
        `;
        tbody.innerHTML += row;
    });
}
document.addEventListener("DOMContentLoaded", actualizarListaTrabajadores);


// Definir todos los documentos y capacitaciones que deberían ser recibidos
const todosLosDocumentos = [
    "Formato único de hoja de vida",
    "Pruebas psicotécnicas",
    "Fotocopia documentos de identidad",
    "Antecedentes disciplinarios (Procuraduría-Policía-Contraloría)",
    "Certificados laborales",
    "Certificados de estudios",
    "Certificados de experiencia laboral",
    "Validación de referencias",
    "Certificado afiliación a E.P.S.",
    "Certificado afiliación a A.F.P.",
    "Fotocopia registro unitario (R.U.T.)",
    "Examen médico de ingreso",
    "Certificación bancaria",
    "Contrato y anexos"
];

const todasLasCapacitaciones = [
    "Inducción y reinducción",
    "Buenas prácticas",
    "Accidentes",
    "Riesgos",
    "Comités y brigada",
    "Actos y condiciones inseguras",
    "¿Qué hacer en casos de emergencias?",
    "Dotación y EPP",
    "Política SST",
    "Política de Prevención del Consumo de Alcohol, Tabaco y otras Sustancias Psicoactivas"
];

function mostrarMasInformacion(index) {
    let trabajador = trabajadores[index];

    // Mostrar la foto del trabajador si está disponible
    const fotoTrabajadorDetalle = document.getElementById("fotoTrabajadorDetalle");
    if (trabajador.foto) {
        fotoTrabajadorDetalle.src = trabajador.foto;
        fotoTrabajadorDetalle.style.display = "block";
    } else {
        fotoTrabajadorDetalle.style.display = "none";
    }

    // Filtrar las capacitaciones y documentos que faltan
    const capacitacionesFaltantes = todasLasCapacitaciones.filter(cap => !trabajador.capacitacionesRecibidas.includes(cap));
    const documentosFaltantes = todosLosDocumentos.filter(doc => !trabajador.documentosRecibidos.includes(doc));

    // Mostrar los detalles del trabajador en el formato deseado
    let detalles = `

    <div class="full-width">
        <h4>Información Personal</h4>
    </div>

        <div class="form-group">
            <label>ID del Trabajador:</label>
            <span>${trabajador.id || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Nombre y Apellidos:</label>
            <span>${trabajador.nombreApellidos || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Correo Electrónico:</label>
            <span>${trabajador.correoElectronico || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Tipo de Documento:</label>
            <span>${trabajador.tipoDocumento || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Número de Documento:</label>
            <span>${trabajador.numeroDocumento || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Fecha de Nacimiento:</label>
            <span>${trabajador.fechaNacimiento || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>RH:</label>
            <span>${trabajador.rh || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Género:</label>
            <span>${trabajador.genero || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Ciudad:</label>
            <span>${trabajador.ciudad || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Barrio de Residencia:</label>
            <span>${trabajador.barrioResidencia || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Dirección de Residencia:</label>
            <span>${trabajador.direccionResidencia || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Teléfono de Contacto:</label>
            <span>${trabajador.telefonoContacto || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Teléfono de Emergencia:</label>
            <span>${trabajador.telefonoEmergencia || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Estado Civil:</label>
            <span>${trabajador.estadoCivil || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Número de Hijos:</label>
            <span>${trabajador.numeroHijos || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Edad de los Hijos:</label>
            <span>${trabajador.edadHijos || "No disponible"}</span>
        </div>

    <div class="full-width">
        <h4>Información Laboral</h4>
    </div>

        <div class="form-group">
            <label>Última Experiencia Laboral:</label>
            <span>${trabajador.ultimaExperiencia || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Empresa:</label>
            <span>${trabajador.empresa || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Cargo:</label>
            <span>${trabajador.cargo || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Fecha de Ingreso Laboral:</label>
            <span>${trabajador.fechaIngresoLaboral || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Fecha de Retiro Laboral:</label>
            <span>${trabajador.fechaRetiroLaboral || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Teléfono Laboral:</label>
            <span>${trabajador.telefonoLaboral || "No disponible"}</span>
        </div>

    <div class="full-width">
        <h4>Información de Salud</h4>
    </div>

        <div class="form-group">
            <label>ARL:</label>
            <span>${trabajador.arl || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>EPS:</label>
            <span>${trabajador.eps || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Pensión:</label>
            <span>${trabajador.pension || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Cesantías:</label>
            <span>${trabajador.cesantias || "No disponible"}</span>
        </div>

                    <div class="full-width">
                        <h4>Información academica</h4>
                    </div>
        <div class="form-group">
            <label>Título Obtenido:</label>
            <span>${trabajador.tituloObtenido || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Institución:</label>
            <span>${trabajador.institucion || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Ciudad Académica:</label>
            <span>${trabajador.ciudadAcademica || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Último Grado:</label>
            <span>${trabajador.ultimoGrado || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Año Culminado:</label>
            <span>${trabajador.anioCulminado || "No disponible"}</span>
        </div>

    <div class="full-width">
        <h4>Información Familiar</h4>
    </div>

        <div class="form-group">
            <label>Parentesco:</label>
            <span>${trabajador.parentesco || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Nombre del Familiar:</label>
            <span>${trabajador.nombreFamiliar || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Teléfono del Familiar:</label>
            <span>${trabajador.telefonoFamiliar || "No disponible"}</span>
        </div>

    <div class="full-width">
        <h4>Información Financiera</h4>
    </div>

        <div class="form-group">
            <label>Modelo de Contrato:</label>
            <span>${trabajador.Modcontrato || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Tipo de Cuenta:</label>
            <span>${trabajador.tipoCuenta || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Banco:</label>
            <span>${trabajador.banco || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Tipo de Documento del Titular:</label>
            <span>${trabajador.tipoDocumentoTitular || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Nombre del Titular:</label>
            <span>${trabajador.nombreTitular || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Número de Documento del Titular:</label>
            <span>${trabajador.numeroDocumentoTitular || "No disponible"}</span>
        </div>
        <div class="form-group">
            <label>Número de Cuenta:</label>
            <span>${trabajador.numeroCuenta || "No disponible"}</span>
        </div>

    <div class="full-width">
        <h4>Capacitaciones y Documentos</h4>
    </div>

        <div class="form-group">
            <label>Capacitaciones Faltantes:</label>
            <span>${capacitacionesFaltantes.length > 0 ? capacitacionesFaltantes.join(", ") : "Todas las capacitaciones están completas"}</span>
            <span style="color: ${capacitacionesFaltantes.length === 0 ? 'green' : 'red'};">(${capacitacionesFaltantes.length === 0 ? 'Completo' : 'Incompleto'})</span>
        </div>
        <div class="form-group">
            <label>Documentos Faltantes:</label>
            <span>${documentosFaltantes.length > 0 ? documentosFaltantes.join(", ") : "Todos los documentos están completos"}</span>
            <span style="color: ${documentosFaltantes.length === 0 ? 'green' : 'red'};">(${documentosFaltantes.length === 0 ? 'Completo' : 'Incompleto'})</span>
        </div>
    `;

    // Mostrar los detalles en el modal
    document.getElementById("detallesTrabajador").innerHTML = detalles;

    // Mostrar el modal
    document.getElementById("modalMasInformacion").style.display = "flex";
}
function cerrarModalMasInformacion() {
    document.getElementById("modalMasInformacion").style.display = "none";
}

        // Filtrar trabajadores
        function filtrarTrabajadores() {
  const filtro = document.getElementById("filtroTrabajadores").value.toLowerCase(); // Obtener el valor del filtro
            const filas = document.querySelectorAll("#listaTrabajadores tr"); // Obtener todas las filas de la tabla

            filas.forEach(fila => {
                const celdas = fila.querySelectorAll("td"); // Obtener todas las celdas de la fila
                let coincide = false;

                // Recorrer las celdas, excluyendo la última (Acciones)
                for (let i = 0; i < celdas.length - 1; i++) {
                    const textoCelda = celdas[i].textContent.toLowerCase(); // Obtener el texto de la celda
                    if (textoCelda.includes(filtro)) {
                        coincide = true; // Si coincide, marcar como verdadero
                        break; // Salir del bucle
                    }
                }

                // Mostrar u ocultar la fila según si coincide con el filtro
                if (coincide) {
                    fila.style.display = ""; // Mostrar la fila
                } else {
                    fila.style.display = "none"; // Ocultar la fila
                }
            });
        }
        // Eliminar trabajador
function eliminarTrabajador(index) {
    Swal.fire({
        title: '¿Estás seguro?',
        text: "¡No podrás revertir esto!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Sí, eliminar!'
    }).then((result) => {
        if (result.isConfirmed) {
            trabajadores.splice(index, 1);
            localStorage.setItem("trabajadores", JSON.stringify(trabajadores));
            actualizarListaTrabajadores();
            Swal.fire('¡Eliminado!', 'El trabajador fue eliminado.', 'success');
        }
    });
}

        // Registrar jornada laboral
document.getElementById("registroJornadaForm").addEventListener("submit", function(e) {
    e.preventDefault();
    
    // Validar selección de ciudad y cliente
    const ciudad = document.getElementById("ciudadJornada").value;
    const cliente = document.getElementById("sede").value;
    
    if (!ciudad || !cliente) {
        Swal.fire("Error", "Debe seleccionar ciudad y cliente", "error");
        return;
    }

    // Obtener valores del formulario
    const trabajadorId = document.getElementById("nombreTrabajadorJornada").value;
    const sede = document.getElementById("sede").value;
    const operacion = document.getElementById("operacion").value;
    const fecha = document.getElementById("fechaJornada").value;
    const horaInicio = document.getElementById("horaInicio").value;
    const horaFin = document.getElementById("horaFin").value;
    const tipoJornada = document.getElementById("tipoJornada").value;

    // Validaciones básicas
    if (!trabajadorId || !sede || !fecha || !horaInicio || !horaFin) {
        Swal.fire("Error", "Todos los campos son obligatorios", "error");
        return;
    }

    // Buscar trabajador
    const trabajador = trabajadores.find(t => t.numeroDocumento === trabajadorId);
    if (!trabajador) {
        Swal.fire("Error", "Trabajador no encontrado", "error");
        return;
    }

    // Calcular horas
    const horasTrabajadas = calcularHoras(horaInicio, horaFin);
    const horasExtras = Math.max(horasTrabajadas - 8, 0);

    // Buscar tarifas
    const tarifa = tarifas.find(t => t.sede === sede && t.operacion === operacion);
    if (!tarifa) {
        Swal.fire("Error", "Tarifa no configurada para esta sede/operación", "error");
        return;
    }

    // Calcular valor
    let valorTotal = 0;
    if (tipoJornada === "diurna") {
        valorTotal = (Math.min(horasTrabajadas, 8) * tarifa.tarifasPago.diurna) + 
                    (horasExtras * tarifa.tarifasPago.extraDiurna);
    } else if (tipoJornada === "nocturna") {
        valorTotal = (Math.min(horasTrabajadas, 8) * tarifa.tarifasPago.nocturna) + 
                    (horasExtras * tarifa.tarifasPago.extraNocturna);
    }

    // Crear registro
    const nuevaJornada = {
        id: Date.now(),
        trabajador: trabajador.numeroDocumento,
        nombre: trabajador.nombreApellidos,
        sede,
        operacion,
        fecha,
        horaInicio,
        horaFin,
        horasTrabajadas,
        horasExtras,
        tipoJornada,
        valorTotal
    };

    registrosJornadas.push(nuevaJornada);
    localStorage.setItem("registrosJornadas", JSON.stringify(registrosJornadas));
    
    mostrarRegistrosJornadas();
    Swal.fire("Éxito", "Jornada registrada correctamente", "success");
    this.reset();
    cerrarModalJornada();
});

        // Calcular horas trabajadas

function calcularHoras(horaInicio, horaFin) {
    const inicio = new Date(`2000-01-01T${horaInicio}`);
    const fin = new Date(`2000-01-01T${horaFin}`);
    const diferencia = fin - inicio;
    return (diferencia / 1000 / 60 / 60).toFixed(2); // Horas con 2 decimales
}

function validarPermisos(usuario) {
    if (usuario.nombre === "Gerente") {
        usuario.accesoTrabajadores = true;
        usuario.accesoJornadas = true;
        usuario.accessoTarifas = true;
        usuario.accessoSedes = true;
    }
}

function mostrarFotoEnModal(foto) {
    const fotoPreview = document.getElementById("fotoTrabajadorPreview");
    if (foto) {
        fotoPreview.src = foto;
        fotoPreview.style.display = "block";
    } else {
        fotoPreview.style.display = "none";
    }
}

        // Mostrar registros de jornadas
function mostrarRegistrosJornadas() {
    const tbody = document.getElementById("tablaRegistrosJornadas");
    tbody.innerHTML = "";
    let total = 0;

    registrosJornadas.forEach((jornada, index) => {
        const row = `
        <tr>
            <td>${jornada.trabajador}</td>
            <td>${jornada.nombre}</td>
            <td>${jornada.sede}</td>
            <td>${jornada.operacion}</td>
            <td>${jornada.fecha}</td>
            <td>${jornada.horaInicio}</td>
            <td>${jornada.horaFin}</td>
            <td>${parseFloat(jornada.horasTrabajadas).toFixed(2)}</td>
            <td>${parseFloat(jornada.horasExtras).toFixed(2)}</td>
            <td>${jornada.tipoJornada}</td>
            <td>$${jornada.valorTotal.toLocaleString()}</td>
            <td>
                <button class="btn-editar" onclick="editarJornada(${index})">Editar</button>
                <button class="btn-eliminar" onclick="eliminarJornada(${index})">Eliminar</button>
            </td>
        </tr>`;
        tbody.innerHTML += row;
        total += jornada.valorTotal;
    });

    document.getElementById("totalPagoJornadas").innerHTML = `
        Total a pagar: $${total.toLocaleString()}
    `;
}
        // Actualizar jornadas con las nuevas tarifas
function actualizarJornadas() {
    registrosJornadas.forEach(registro => {
        let tarifaSede = tarifas.find(t => t.sede === registro.sede && t.operacion === registro.operacion);
        if (tarifaSede) {
            let horasExtras = Math.max(0, registro.horasTrabajadas - 8);
            if (registro.tipoJornada === "diurna") {
                registro.valorTotal = (Math.min(registro.horasTrabajadas, 8) * tarifaSede.diurna) + (horasExtras * tarifaSede.extraDiurna);
            } else if (registro.tipoJornada === "nocturna") {
                registro.valorTotal = (Math.min(registro.horasTrabajadas, 8) * tarifaSede.nocturna) + (horasExtras * tarifaSede.extraNocturna);
            } else if (registro.tipoJornada === "dominical") {
                registro.valorTotal = registro.horasTrabajadas * tarifaSede.dominical;
            }
        }
    });
    localStorage.setItem("registrosJornadas", JSON.stringify(registrosJornadas));
    mostrarRegistrosJornadas();
    Swal.fire("Éxito", "Jornadas actualizadas con las nuevas tarifas", "success");
}
        // Registrar tarifas
document.getElementById("tarifasForm").addEventListener("submit", function(event) {
    event.preventDefault();



    let sede = document.getElementById("sedeTarifa").value;
    let operacion = document.getElementById("operacionTarifa").value;

    // Tarifas de pago
    let tarifaDiurnaPago = parseFloat(document.getElementById("tarifaDiurnaPago").value);
    let tarifaExtraDiurnaPago = parseFloat(document.getElementById("tarifaExtraDiurnaPago").value);
    let tarifaNocturnaPago = parseFloat(document.getElementById("tarifaNocturnaPago").value);
    let tarifaExtraNocturnaPago = parseFloat(document.getElementById("tarifaExtraNocturnaPago").value);
    let tarifaDominicalPago = parseFloat(document.getElementById("tarifaDominicalPago").value);

    // Tarifas de cobro
    let tarifaDiurnaCobro = parseFloat(document.getElementById("tarifaDiurnaCobro").value);
    let tarifaExtraDiurnaCobro = parseFloat(document.getElementById("tarifaExtraDiurnaCobro").value);
    let tarifaNocturnaCobro = parseFloat(document.getElementById("tarifaNocturnaCobro").value);
    let tarifaExtraNocturnaCobro = parseFloat(document.getElementById("tarifaExtraNocturnaCobro").value);
    let tarifaDominicalCobro = parseFloat(document.getElementById("tarifaDominicalCobro").value);

    // Verificar si ya existe una tarifa para esta sede y operación
    let tarifaExistente = tarifas.find(t => t.sede === sede && t.operacion === operacion);
    if (tarifaExistente) {
        // Actualizar tarifa existente
        tarifaExistente.tarifasPago = {
            diurna: tarifaDiurnaPago,
            extraDiurna: tarifaExtraDiurnaPago,
            nocturna: tarifaNocturnaPago,
            extraNocturna: tarifaExtraNocturnaPago,
            dominical: tarifaDominicalPago
        };
        tarifaExistente.tarifasCobro = {
            diurna: tarifaDiurnaCobro,
            extraDiurna: tarifaExtraDiurnaCobro,
            nocturna: tarifaNocturnaCobro,
            extraNocturna: tarifaExtraNocturnaCobro,
            dominical: tarifaDominicalCobro
        };
    } else {
        // Crear nueva tarifa
        tarifas.push({
            sede: sede,
            operacion: operacion,
            tarifasPago: {
                diurna: tarifaDiurnaPago,
                extraDiurna: tarifaExtraDiurnaPago,
                nocturna: tarifaNocturnaPago,
                extraNocturna: tarifaExtraNocturnaPago,
                dominical: tarifaDominicalPago
            },
            tarifasCobro: {
                diurna: tarifaDiurnaCobro,
                extraDiurna: tarifaExtraDiurnaCobro,
                nocturna: tarifaNocturnaCobro,
                extraNocturna: tarifaExtraNocturnaCobro,
                dominical: tarifaDominicalCobro
            }
        });
    }
    localStorage.setItem("tarifas", JSON.stringify(tarifas));
    mostrarTarifas();
    Swal.fire("Éxito", "Tarifa registrada correctamente", "success");
    this.reset();
    cerrarModalTarifa();
});

        // Mostrar tarifas
function mostrarTarifas() {
    const tbody = document.getElementById("tablaTarifas");
    tbody.innerHTML = "";

    tarifas.forEach((tarifa, index) => {
        // Validar estructura de la tarifa
        if (!tarifa?.tarifasPago || !tarifa?.tarifasCobro) {
            console.error(`Tarifa en índice ${index} no tiene la estructura correcta:`, tarifa);
            return;
        }

        const fila = `<tr>
            <td>${tarifa.sede}</td>
            <td>${tarifa.operacion}</td>
            <td>$${tarifa.tarifasPago.diurna?.toLocaleString() || "N/A"}</td>
            <td>$${tarifa.tarifasPago.extraDiurna?.toLocaleString() || "N/A"}</td>
            <td>$${tarifa.tarifasPago.nocturna?.toLocaleString() || "N/A"}</td>
            <td>$${tarifa.tarifasPago.extraNocturna?.toLocaleString() || "N/A"}</td>
            <td>$${tarifa.tarifasPago.dominical?.toLocaleString() || "N/A"}</td>
            <td>$${tarifa.tarifasCobro.diurna?.toLocaleString() || "N/A"}</td>
            <td>$${tarifa.tarifasCobro.extraDiurna?.toLocaleString() || "N/A"}</td>
            <td>$${tarifa.tarifasCobro.nocturna?.toLocaleString() || "N/A"}</td>
            <td>$${tarifa.tarifasCobro.extraNocturna?.toLocaleString() || "N/A"}</td>
            <td>$${tarifa.tarifasCobro.dominical?.toLocaleString() || "N/A"}</td>
            <td>
                <button class="btn-editar" onclick="abrirModalEditarTarifa(${index})">Editar</button>
                <button class="btn-eliminar" onclick="eliminarTarifa(${index})">Eliminar</button>
            </td>
        </tr>`;
        tbody.innerHTML += fila;
    });
}
        document.addEventListener("DOMContentLoaded", mostrarTarifas);

        // Eliminar tarifa
function eliminarTarifa(index) {
    tarifas.splice(index, 1);
    localStorage.setItem("tarifas", JSON.stringify(tarifas));
    mostrarTarifas();
    Swal.fire("Éxito", "Tarifa eliminada correctamente", "success");
}

function mostrarSedes() {
    let tbody = document.getElementById("tablaSedes");
    tbody.innerHTML = "";
    sedes.forEach((sede, index) => {
        let fila = `<tr>
            <td>${sede.id || "N/A"}</td>
            <td>${sede.ciudad || "N/A"}</td>
            <td>${sede.cliente || "N/A"}</td>
            <td>${sede.operaciones ? sede.operaciones.join(", ") : "N/A"}</td>
            <td>${sede.nit || "N/A"}</td>
            <td>${sede.direccion || "N/A"}</td>
            <td>${sede.telefono || "N/A"}</td>
            <td>${sede.fechaCreacion || "N/A"}</td>
            <td>
                <button class="btn-editar" onclick="abrirModalEditarSede(${index})">Editar</button>
                <button class="btn-eliminar" onclick="eliminarSede(${index})">Eliminar</button>
            </td>
        </tr>`;
        tbody.innerHTML += fila;
    });
}



        document.addEventListener("DOMContentLoaded", mostrarSedes);

        // Eliminar sede
function eliminarSede(index) {
    Swal.fire({
        title: '¿Estás seguro?',
        text: "¡No podrás revertir esto!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Sí, eliminar!'
    }).then((result) => {
        if (result.isConfirmed) {
            sedes.splice(index, 1);
            localStorage.setItem("sedes", JSON.stringify(sedes));
            mostrarSedes();
            Swal.fire('¡Eliminado!', 'La sede fue eliminada.', 'success');
        }
    });
}
function generarCarnet() {
    const trabajadorId = document.getElementById("editarTrabajadorId").value;

    if (trabajadorId === undefined || trabajadorId === null || trabajadorId === "") {
        Swal.fire("Error", "No se ha seleccionado un trabajador válido.", "error");
        return;
    }

    const trabajador = trabajadores[trabajadorId];

    if (!trabajador) {
        Swal.fire("Error", "No se encontró información del trabajador.", "error");
        return;
    }

    if (!trabajador.numeroDocumento) {
        Swal.fire("Error", "El número de documento del trabajador no está definido.", "error");
        return;
    }

    const doc = new jspdf.jsPDF({
        orientation: "portrait",
        unit: "mm",
        format: [85, 54]
    });

    doc.setFontSize(16);
    doc.setFont("helvetica", "bold");
    doc.text("RMRPLUS", 42.5, 10, { align: "center" });

    doc.setFontSize(12);
    doc.setFont("helvetica", "normal");
    doc.text("LOGISTICS", 42.5, 16, { align: "center" });

    doc.setFontSize(10);
    doc.text(`NOMBRE: ${trabajador.nombreApellidos}`, 10, 25);
    doc.text(`CARGO: ${trabajador.cargo}`, 10, 30);
    doc.text(`TIPO DOC-NUM.DOC: ${trabajador.tipoDocumento} - ${trabajador.numeroDocumento}`, 10, 35);
    doc.text(`RH: ${trabajador.rh}`, 10, 40);

    doc.save(`carnet_${trabajador.numeroDocumento}.pdf`);
}

function abrirModalEditarSede(index) {
    let sede = sedes[index];
    document.getElementById("ciudadSede").value = sede.ciudad;
    document.getElementById("clienteSede").value = sede.cliente;
    document.getElementById("nitSede").value = sede.nit;
    document.getElementById("direccionSede").value = sede.direccion;
    document.getElementById("telefonoSede").value = sede.telefono;
    document.getElementById("fechaCreacion").value = sede.fechaCreacion;

    // Marcar los checkboxes de las operaciones seleccionadas
    document.querySelectorAll('#operacionesChecklist input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = sede.operaciones.includes(checkbox.value);
    });

    // Guardar el índice de la sede que se está editando
    document.getElementById("modalSede").dataset.index = index;

    // Cambiar el texto del botón de guardar
    document.querySelector("#modalSede button").textContent = "Guardar Cambios";

    // Mostrar el modal
    document.getElementById("modalSede").style.display = "flex";
}

function guardarSede() {
    const ciudadInput = document.getElementById("ciudadSede");
    const clienteInput = document.getElementById("clienteSede");
    
    const ciudad = ciudadInput.value.trim().toLowerCase();
    const cliente = clienteInput.value.trim().toLowerCase();
    
    // Obtener el índice de la sede que se está editando
    const index = document.getElementById("modalSede").dataset.index;

    // Verificar si ya existe una sede con la misma combinación, excluyendo la sede que se está editando
    const existeCombinacion = sedes.some((sede, i) => 
        sede.ciudad.toLowerCase() === ciudad && 
        sede.cliente.toLowerCase() === cliente && 
        i !== index // Excluir la sede que se está editando
    );
    
    if (existeCombinacion) {
        Swal.fire("Error", "¡Esta combinación Ciudad-Cliente ya existe!", "error");
        return;
    }

    // Obtener valores restantes
    const nit = document.getElementById("nitSede").value.trim();
    const direccion = document.getElementById("direccionSede").value.trim();
    const telefono = document.getElementById("telefonoSede").value.trim();
    const fechaCreacion = document.getElementById("fechaCreacion").value;

    // Capitalizar para almacenamiento
    const ciudadCapitalizada = ciudad.charAt(0).toUpperCase() + ciudad.slice(1);
    const clienteCapitalizado = cliente.charAt(0).toUpperCase() + cliente.slice(1);

    // Obtener operaciones
    const operaciones = Array.from(document.querySelectorAll('#operacionesChecklist input:checked'))
                            .map(checkbox => checkbox.value);

    // Validación completa
    if (!ciudad || !cliente || !nit || !direccion || !telefono || operaciones.length === 0) {
        Swal.fire("Error", "Todos los campos son obligatorios y debe seleccionar al menos una operación", "warning");
        return;
    }

    // Lógica de edición/creación corregida
    if (index !== undefined && index !== "") {
        // Editar existente
        sedes[index] = { 
            ...sedes[index],
            ciudad: ciudadCapitalizada,
            cliente: clienteCapitalizado,
            operaciones,
            nit,
            direccion,
            telefono,
            fechaCreacion
        };
    } else {
        // Nueva sede
        const nuevaSede = { 
            id: generarIdSede(),
            ciudad: ciudadCapitalizada,
            cliente: clienteCapitalizado,
            operaciones,
            nit,
            direccion,
            telefono,
            fechaCreacion: new Date().toISOString().split('T')[0] // Fecha actual si no se especifica
        };
        sedes.push(nuevaSede);
    }

    localStorage.setItem("sedes", JSON.stringify(sedes));
    mostrarSedes();
    Swal.fire("Éxito", "Sede guardada correctamente", "success");
    cerrarModalSede();
}

function abrirModalSede() {
    console.log("Abriendo modal de sedes"); // Verifica si la función se está ejecutando
    let modal = document.getElementById("modalSede");
    if (modal) {
        modal.style.display = "flex";
    } else {
        console.error("El modal de sedes no existe.");
    }
}

function abrirModalEditarTarifa(index) {
    const tarifa = tarifas[index];

    // Llenar los campos del modal con los datos de la tarifa
   document.getElementById("editarClienteTarifa").value = tarifa.cliente;
    document.getElementById("editarSedeTarifa").value = tarifa.sede;
    document.getElementById("editarOperacionTarifa").value = tarifa.operacion;
    document.getElementById("editarTarifaDiurnaPago").value = tarifa.tarifasPago.diurna;
    document.getElementById("editarTarifaExtraDiurnaPago").value = tarifa.tarifasPago.extraDiurna;
    document.getElementById("editarTarifaNocturnaPago").value = tarifa.tarifasPago.nocturna;
    document.getElementById("editarTarifaExtraNocturnaPago").value = tarifa.tarifasPago.extraNocturna;
    document.getElementById("editarTarifaDominicalPago").value = tarifa.tarifasPago.dominical;
    document.getElementById("editarTarifaDiurnaCobro").value = tarifa.tarifasCobro.diurna;
    document.getElementById("editarTarifaExtraDiurnaCobro").value = tarifa.tarifasCobro.extraDiurna;
    document.getElementById("editarTarifaNocturnaCobro").value = tarifa.tarifasCobro.nocturna;
    document.getElementById("editarTarifaExtraNocturnaCobro").value = tarifa.tarifasCobro.extraNocturna;
    document.getElementById("editarTarifaDominicalCobro").value = tarifa.tarifasCobro.dominical;

    // Guardar el índice de la tarifa que se está editando
    document.getElementById("modalEditarTarifa").dataset.index = index;

    // Mostrar el modal
    document.getElementById("modalEditarTarifa").style.display = "flex";
}


function cerrarModalSede() {
    let modal = document.getElementById("modalSede");
    if (modal) {
        modal.style.display = "none";
        document.getElementById("ciudadSede").value = "";
        document.getElementById("clienteSede").value = "";
        document.getElementById("nitSede").value = "";
        document.getElementById("direccionSede").value = "";
        document.getElementById("telefonoSede").value = "";
        document.getElementById("fechaCreacion").value = "";

        // Limpiar los checkboxes
        document.querySelectorAll('#operacionesChecklist input[type="checkbox"]').forEach(checkbox => {
            checkbox.checked = false;
        });

        delete modal.dataset.index; // Elimina el índice de edición
    }
}

function generarIdSede() {
    const ultimoId = sedes.length > 0 ? 
        Math.max(...sedes.map(s => parseInt(s.id.replace('C','')))) : 0;
    return `C${String(ultimoId + 1).padStart(3, '0')}`;
}

document.addEventListener("DOMContentLoaded", function () {

document.getElementById("editarTarifasForm").addEventListener("submit", function (event) {
    event.preventDefault();

    // Obtener el índice de la tarifa que se está editando
    const index = document.getElementById("modalEditarTarifa").dataset.index;

    // Actualizar los datos de la tarifa
    tarifas[index].sede = document.getElementById("editarSedeTarifa").value;
    tarifas[index].operacion = document.getElementById("editarOperacionTarifa").value;
    tarifas[index].tarifasPago.diurna = parseFloat(document.getElementById("editarTarifaDiurnaPago").value);
    tarifas[index].tarifasPago.extraDiurna = parseFloat(document.getElementById("editarTarifaExtraDiurnaPago").value);
    tarifas[index].tarifasPago.nocturna = parseFloat(document.getElementById("editarTarifaNocturnaPago").value);
    tarifas[index].tarifasPago.extraNocturna = parseFloat(document.getElementById("editarTarifaExtraNocturnaPago").value);
    tarifas[index].tarifasPago.dominical = parseFloat(document.getElementById("editarTarifaDominicalPago").value);
    tarifas[index].tarifasCobro.diurna = parseFloat(document.getElementById("editarTarifaDiurnaCobro").value);
    tarifas[index].tarifasCobro.extraDiurna = parseFloat(document.getElementById("editarTarifaExtraDiurnaCobro").value);
    tarifas[index].tarifasCobro.nocturna = parseFloat(document.getElementById("editarTarifaNocturnaCobro").value);
    tarifas[index].tarifasCobro.extraNocturna = parseFloat(document.getElementById("editarTarifaExtraNocturnaCobro").value);
    tarifas[index].tarifasCobro.dominical = parseFloat(document.getElementById("editarTarifaDominicalCobro").value);

    // Guardar los cambios en localStorage
    localStorage.setItem("tarifas", JSON.stringify(tarifas));

    // Actualizar la tabla de tarifas
    mostrarTarifas();

    // Cerrar el modal
    cerrarModalEditarTarifa();

    // Mostrar mensaje de éxito
    Swal.fire("Éxito", "Tarifa actualizada correctamente", "success");
    });
});
function cerrarModalEditarTarifa() {
    document.getElementById("modalEditarTarifa").style.display = "none";
}

function importarDesdeExcel(event) {
    const file = event.target.files[0];
    if (!file) {
        return;
    }

    const reader = new FileReader();
    reader.onload = function (e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });

        // Supongamos que los datos están en la primera hoja
        const sheetName = workbook.SheetNames[0];
        const worksheet = workbook.Sheets[sheetName];

        // Convertir la hoja de cálculo a JSON
        const json = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

        // Procesar los datos
        const sedesImportadas = json.slice(1).map(row => ({
            id: row[0] || generarIdSede(), // Si no hay ID, generamos uno
            ciudad: row[1],
            cliente: row[2],
            operaciones: row[3] ? row[3].split(',').map(op => op.trim()) : [],
            nit: row[4],
            direccion: row[5],
            telefono: row[6],
            fechaCreacion: row[7] || new Date().toISOString().split('T')[0] // Si no hay fecha, usamos la actual
        }));

        // Agregar las sedes importadas a la lista existente
        sedes.push(...sedesImportadas);

        // Guardar en localStorage
        localStorage.setItem("sedes", JSON.stringify(sedes));

        // Actualizar la tabla de sedes
        mostrarSedes();

        // Mostrar mensaje de éxito
        Swal.fire("Éxito", "Sedes importadas correctamente", "success");
    };

    reader.readAsArrayBuffer(file);
}

function abrirModalTarifa() {
    // Limpiar el select de clientes
    const selectCliente = document.getElementById("clienteTarifa");
    selectCliente.innerHTML = '<option value="">Seleccione un cliente</option>';

    // Obtener la lista de clientes únicos desde las sedes
    const clientesUnicos = [...new Set(sedes.map(sede => sede.cliente))];

    // Llenar el select con los clientes
    clientesUnicos.forEach(cliente => {
        const option = document.createElement("option");
        option.value = cliente;
        option.textContent = cliente;
        selectCliente.appendChild(option);
    });

    actualizarFiltroSedes(); // Asegúrate de que esta línea esté presente
    document.getElementById("modalTarifas").style.display = "flex";

}

document.getElementById("tarifasForm").addEventListener("submit", function (event) {
    event.preventDefault();

    // Obtener los valores del formulario

    const sede = document.getElementById("sedeTarifa").value;
    const cliente = document.getElementById("clienteTarifa").value;
    const operacion = document.getElementById("operacionTarifa").value;

    // Tarifas de pago
    const tarifaDiurnaPago = parseFloat(document.getElementById("tarifaDiurnaPago").value);
    const tarifaExtraDiurnaPago = parseFloat(document.getElementById("tarifaExtraDiurnaPago").value);
    const tarifaNocturnaPago = parseFloat(document.getElementById("tarifaNocturnaPago").value);
    const tarifaExtraNocturnaPago = parseFloat(document.getElementById("tarifaExtraNocturnaPago").value);
    const tarifaDominicalPago = parseFloat(document.getElementById("tarifaDominicalPago").value);

    // Tarifas de cobro
    const tarifaDiurnaCobro = parseFloat(document.getElementById("tarifaDiurnaCobro").value);
    const tarifaExtraDiurnaCobro = parseFloat(document.getElementById("tarifaExtraDiurnaCobro").value);
    const tarifaNocturnaCobro = parseFloat(document.getElementById("tarifaNocturnaCobro").value);
    const tarifaExtraNocturnaCobro = parseFloat(document.getElementById("tarifaExtraNocturnaCobro").value);
    const tarifaDominicalCobro = parseFloat(document.getElementById("tarifaDominicalCobro").value);

    // Verificar si ya existe una tarifa para este cliente, sede y operación
    const tarifaExistente = tarifas.find(t => t.cliente === cliente && t.sede === sede && t.operacion === operacion);

    if (tarifaExistente) {
        // Actualizar tarifa existente
        tarifaExistente.tarifasPago = {
            diurna: tarifaDiurnaPago,
            extraDiurna: tarifaExtraDiurnaPago,
            nocturna: tarifaNocturnaPago,
            extraNocturna: tarifaExtraNocturnaPago,
            dominical: tarifaDominicalPago
        };
        tarifaExistente.tarifasCobro = {
            diurna: tarifaDiurnaCobro,
            extraDiurna: tarifaExtraDiurnaCobro,
            nocturna: tarifaNocturnaCobro,
            extraNocturna: tarifaExtraNocturnaCobro,
            dominical: tarifaDominicalCobro
        };
    } else {
        // Crear nueva tarifa
        tarifas.push({
            cliente,
            sede,
            operacion,
            tarifasPago: {
                diurna: tarifaDiurnaPago,
                extraDiurna: tarifaExtraDiurnaPago,
                nocturna: tarifaNocturnaPago,
                extraNocturna: tarifaExtraNocturnaPago,
                dominical: tarifaDominicalPago
            },
            tarifasCobro: {
                diurna: tarifaDiurnaCobro,
                extraDiurna: tarifaExtraDiurnaCobro,
                nocturna: tarifaNocturnaCobro,
                extraNocturna: tarifaExtraNocturnaCobro,
                dominical: tarifaDominicalCobro
            }
        });
    }

    // Guardar en localStorage
    localStorage.setItem("tarifas", JSON.stringify(tarifas));

    // Actualizar la tabla de tarifas
    mostrarTarifas();

    // Mostrar mensaje de éxito
    Swal.fire("Éxito", "Tarifa registrada correctamente", "success");

    // Limpiar el formulario y cerrar el modal
    this.reset();
    cerrarModalTarifa();
});

function cambiarSeccion(seccionId) {
    document.querySelectorAll('.seccion').forEach(sec => {
        sec.classList.remove('activo');
    });
    document.getElementById(seccionId).classList.add('activo');
}

// Funciones de exportación
function generarExcel() {
    /* Implementar lógica usando xlsx.full.min.js */
    console.log("Exportando a Excel...");
}

function generarPDF() {
    /* Implementar lógica usando jsPDF */
    console.log("Exportando a PDF...");
}

// Variables globales
        let clientes = JSON.parse(localStorage.getItem("clientes")) || [];
        let prefacturas = JSON.parse(localStorage.getItem("prefacturas")) || [];
// Inicialización de clientes
function inicializarClientes() {
    const select = document.getElementById('clientePrefactura');
    select.innerHTML = '<option value="">Seleccionar Cliente</option>';
    clientes.forEach(cliente => {
        const option = document.createElement('option');
        option.value = cliente.nit;
        option.textContent = `${cliente.razonSocial} (${cliente.nit})`;
        select.appendChild(option);
    });
}

// Función para procesar CSV
async function procesarCSV(archivo) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (e) => {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            resolve(XLSX.utils.sheet_to_json(sheet));
        };
        reader.readAsArrayBuffer(archivo);
    });
}

// Calcular prefactura
function calcularPrefactura(registros) {
    return registros.map(registro => {
        const tarifa = tarifas.find(t => 
            t.sede === registro.sede && 
            t.operacion === registro.operacion
        );
        
        return {
            ...registro,
            total: registro.horas * tarifa.tarifasCobro.diurna
        };
    });
}

// Event Listeners
document.getElementById('formCarguePrefactura').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const archivo = document.getElementById('archivoCSV').files[0];
    const datos = await procesarCSV(archivo);
    const prefacturaCalculada = calcularPrefactura(datos);
    
    prefacturas.push({
        fecha: document.getElementById('fechaPrefactura').value,
        cliente: document.getElementById('clientePrefactura').value,
        registros: prefacturaCalculada,
        total: prefacturaCalculada.reduce((sum, item) => sum + item.total, 0)
    });
    
    localStorage.setItem('prefacturas', JSON.stringify(prefacturas));
    actualizarTablaPrefacturas();
});


// Función para actualizar tabla
function actualizarTablaPrefacturas() {
    const tbody = document.getElementById('tablaPrefacturas');
    tbody.innerHTML = '';
    
    prefacturas.forEach((prefactura, index) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${index + 1}</td>
            <td>${prefactura.cliente}</td>
            <td>${prefactura.registros.length}</td>
            <td>$${prefactura.total.toLocaleString()}</td>
            <td>
                <button class="btn-editar" onclick="verDetallePrefactura(${index})">Detalle</button>
                <button class="btn-eliminar" onclick="eliminarPrefactura(${index})">Eliminar</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

// Función de comparación con nómina
function actualizarComparativo() {
    const totalPrefacturado = prefacturas.reduce((sum, p) => sum + p.total, 0);
    const totalNomina = registrosJornadas.reduce((sum, j) => sum + j.valorTotal, 0);
    const porcentaje = (totalPrefacturado / totalNomina * 100).toFixed(1);
    
    document.getElementById('comparativoNomina').innerHTML = `
        <div class="progress mb-3">
            <div class="progress-bar" role="progressbar" 
                 style="width: ${porcentaje}%">${porcentaje}%</div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <span class="badge bg-primary">Prefacturado: $${totalPrefacturado.toLocaleString()}</span>
            </div>
            <div class="col-md-6">
                <span class="badge bg-warning">Nómina: $${totalNomina.toLocaleString()}</span>
            </div>
        </div>
    `;
}

// Inicialización al cargar
document.addEventListener('DOMContentLoaded', () => {
    inicializarClientes();
    actualizarTablaPrefacturas();
    actualizarComparativo();
});

        function cargarClientesPrefactura() {
            const select = document.getElementById('clientePrefactura');
            select.innerHTML = '<option value="">Seleccionar Cliente</option>';
            clientes.forEach(cliente => {
                const option = document.createElement('option');
                option.value = cliente.nit;
                option.textContent = `${cliente.razonSocial} (${cliente.nit})`;
                select.appendChild(option);
            });
        }

        async function procesarCSV(archivo) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = async (e) => {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const sheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(sheet);
                        resolve(jsonData);
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.onerror = (error) => reject(error);
                reader.readAsArrayBuffer(archivo);
            });
        }

        function calcularValoresPrefactura(registros) {
            return registros.map(registro => {
                const tarifa = tarifas.find(t => 
                    t.sede === registro.sede && 
                    t.operacion === registro.operacion
                );
                
                if (!tarifa) {
                    console.error(`Tarifa no encontrada para ${registro.sede} - ${registro.operacion}`);
                    return null;
                }
                
                return {
                    ...registro,
                    valorUnitario: tarifa.tarifasCobro.diurna,
                    total: registro.horas * tarifa.tarifasCobro.diurna
                };
            }).filter(item => item !== null);
        }

        function actualizarTablaPrefacturas() {
            const tbody = document.getElementById('tablaPrefacturas');
            tbody.innerHTML = '';
            
            prefacturas.forEach((prefactura, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${prefactura.cliente}</td>
                    <td>${prefactura.registros.reduce((sum, r) => sum + r.horas, 0)}</td>
                    <td>$${prefactura.registros[0]?.valorUnitario?.toLocaleString() || 0}</td>
                    <td>$${prefactura.total.toLocaleString()}</td>
                    <td>
                        <button class="btn-editar" onclick="verDetallePrefactura(${index})">📄</button>
                        <button class="btn-eliminar" onclick="eliminarPrefactura(${index})">🗑️</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function eliminarPrefactura(index) {
            Swal.fire({
                title: '¿Eliminar prefactura?',
                text: "Esta acción no se puede deshacer",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Eliminar'
            }).then((result) => {
                if (result.isConfirmed) {
                    prefacturas.splice(index, 1);
                    localStorage.setItem('prefacturas', JSON.stringify(prefacturas));
                    actualizarTablaPrefacturas();
                    actualizarComparativo();
                    Swal.fire('¡Eliminada!', 'La prefactura fue eliminada.', 'success');
                }
            });
        }

        function verDetallePrefactura(index) {
            const prefactura = prefacturas[index];
            let detalles = '<h5>Detalles de la Prefactura</h5><table class="table"><thead><tr>';
            detalles += '<th>Sede</th><th>Operación</th><th>Horas</th><th>Tarifa</th><th>Total</th></tr></thead><tbody>';
            
            prefactura.registros.forEach(registro => {
                detalles += `<tr>
                    <td>${registro.sede}</td>
                    <td>${registro.operacion}</td>
                    <td>${registro.horas}</td>
                    <td>$${registro.valorUnitario.toLocaleString()}</td>
                    <td>$${registro.total.toLocaleString()}</td>
                </tr>`;
            });
            
            detalles += `</tbody></table><p class="total">Total Prefactura: $${prefactura.total.toLocaleString()}</p>`;
            
            Swal.fire({
                title: `Prefactura ${index + 1}`,
                html: detalles,
                width: '800px'
            });
        }

        function actualizarComparativo() {
            const totalPrefacturado = prefacturas.reduce((sum, p) => sum + p.total, 0);
            const totalNomina = registrosJornadas.reduce((sum, j) => sum + j.valorTotal, 0);
            const porcentaje = totalNomina > 0 ? (totalPrefacturado / totalNomina * 100).toFixed(1) : 0;
            
            document.getElementById('comparativoNomina').innerHTML = `
                <div class="progress-container">
                    <div class="progress-bar" style="width: ${porcentaje}%"></div>
                </div>
                <div class="comparativo-numbers">
                    <span class="prefacturado">Prefacturado: $${totalPrefacturado.toLocaleString()}</span>
                    <span class="nomina">Nómina: $${totalNomina.toLocaleString()}</span>
                </div>
            `;
        }


        document.getElementById('formCarguePrefactura').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            try {
                const archivo = document.getElementById('archivoCSV').files[0];
                if (!archivo) {
                    Swal.fire('Error', 'Debe seleccionar un archivo CSV', 'error');
                    return;
                }
                
                const datos = await procesarCSV(archivo);
                const registrosValidos = calcularValoresPrefactura(datos);
                
                if (registrosValidos.length === 0) {
                    Swal.fire('Error', 'El archivo no contiene datos válidos o no se encontraron tarifas', 'error');
                    return;
                }
                
                const nuevaPrefactura = {
                    fecha: document.getElementById('fechaPrefactura').value,
                    cliente: document.getElementById('clientePrefactura').value,
                    registros: registrosValidos,
                    total: registrosValidos.reduce((sum, item) => sum + item.total, 0)
                };
                
                prefacturas.push(nuevaPrefactura);
                localStorage.setItem('prefacturas', JSON.stringify(prefacturas));
                
                actualizarTablaPrefacturas();
                actualizarComparativo();
                
                Swal.fire('Éxito', 'Prefactura generada correctamente', 'success');
                e.target.reset();
            } catch (error) {
                console.error(error);
                Swal.fire('Error', 'Error al procesar el archivo CSV', 'error');
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            // ... (tu código existente) ...
            
            // Añadir estas líneas
            prefacturas = JSON.parse(localStorage.getItem('prefacturas')) || [];
            cargarClientesPrefactura();
            actualizarTablaPrefacturas();
            actualizarComparativo();
        });


// Variables globales
let incidentes = JSON.parse(localStorage.getItem("incidentes")) || [];
let epps = JSON.parse(localStorage.getItem("epps")) || [];
let checklists = JSON.parse(localStorage.getItem("checklists")) || [];

// Funciones HSEQ
function mostrarSubseccionHSEQ(id) {
    document.querySelectorAll('#hseq .subseccion').forEach(sec => {
        sec.style.display = 'none';
    });
    document.getElementById(id).style.display = 'block';
}

// Incidentes
function abrirModalIncidente() {
    document.getElementById("modalIncidente").style.display = "flex";
}

function cerrarModalIncidente() {
    document.getElementById("modalIncidente").style.display = "none";
}

document.getElementById("formIncidente").addEventListener("submit", function(e) {
    e.preventDefault();
    const nuevoIncidente = {
        fecha: document.getElementById("fechaIncidente").value,
        tipo: document.getElementById("tipoIncidente").value,
        descripcion: document.getElementById("descripcionIncidente").value,
        gravedad: document.getElementById("gravedadIncidente").value
    };
    incidentes.push(nuevoIncidente);
    localStorage.setItem("incidentes", JSON.stringify(incidentes));
    actualizarListaIncidentes();
    cerrarModalIncidente();
});

function actualizarListaIncidentes() {
    const tbody = document.getElementById("listaIncidentes");
    tbody.innerHTML = incidentes.map((incidente, index) => `
        <tr>
            <td>${incidente.fecha}</td>
            <td>${incidente.tipo}</td>
            <td>${incidente.descripcion}</td>
            <td>${incidente.gravedad}</td>
            <td>
                <button class="btn-editar">Editar</button>
                <button class="btn-eliminar" onclick="eliminarIncidente(${index})">Eliminar</button>
            </td>
        </tr>
    `).join('');
}

// EPP
function abrirModalEPP() {
    actualizarListaTrabajadoresEPP();
    document.getElementById("modalEPP").style.display = "flex";
}

function actualizarListaTrabajadoresEPP() {
    const select = document.getElementById("trabajadorEPP");
    select.innerHTML = trabajadores.map(t => 
        `<option value="${t.numeroDocumento}">${t.nombreApellidos}</option>`
    ).join('');
}

document.getElementById("formEPP").addEventListener("submit", function(e) {
    e.preventDefault();
    const nuevoEPP = {
        trabajador: document.getElementById("trabajadorEPP").value,
        tipo: document.getElementById("tipoEPP").value,
        entrega: document.getElementById("fechaEntregaEPP").value,
        vencimiento: document.getElementById("vencimientoEPP").value,
        estado: "Vigente"
    };
    epps.push(nuevoEPP);
    localStorage.setItem("epps", JSON.stringify(epps));
    actualizarListaEPP();
    cerrarModalEPP();
});

function actualizarListaEPP() {
    const tbody = document.getElementById("listaEPP");
    tbody.innerHTML = epps.map((epp, index) => `
        <tr>
            <td>${trabajadores.find(t => t.numeroDocumento === epp.trabajador)?.nombreApellidos}</td>
            <td>${epp.tipo}</td>
            <td>${epp.entrega}</td>
            <td>${epp.vencimiento}</td>
            <td>${epp.estado}</td>
        </tr>
    `).join('');
}

// Checklist
function cargarChecklist() {
    const container = document.getElementById("checklistContainer");
    container.innerHTML = `
        <div class="checklist-item">
            <label><input type="checkbox"> Verificación de EPP</label>
        </div>
        <div class="checklist-item">
            <label><input type="checkbox"> Estado de áreas comunes</label>
        </div>
        <!-- Agregar más items según necesidad -->
    `;
}

// Actualizar KPIs
function actualizarKPIs() {
    const totalTrabajadores = trabajadores.length;
    const incidentesGraves = incidentes.filter(i => i.gravedad === "Grave").length;
    const eppVigentes = epps.filter(e => new Date(e.vencimiento) > new Date()).length;
    
    document.getElementById("tasaIncidentes").textContent = 
        `${((incidentesGraves / totalTrabajadores) * 100).toFixed(1)}%`;
        
    document.getElementById("cumplimientoEPP").textContent = 
        `${((eppVigentes / epps.length) * 100).toFixed(1)}%`;
}

// Inicialización
document.addEventListener("DOMContentLoaded", () => {
    // Cargar datos existentes
    trabajadores = JSON.parse(localStorage.getItem("trabajadores")) || [];
    tarifas = JSON.parse(localStorage.getItem("tarifas")) || [];
    registrosJornadas = JSON.parse(localStorage.getItem("registrosJornadas")) || [];
    
    // Llenar selectores
    actualizarFiltroTrabajadores();
    actualizarFiltroSedes();
    mostrarRegistrosJornadas();
});

function actualizarFiltroTrabajadores() {
    const select = document.getElementById("nombreTrabajadorJornada");
    select.innerHTML = '<option value="">Seleccione trabajador</option>';
    trabajadores.forEach(t => {
        select.innerHTML += `<option value="${t.numeroDocumento}">${t.nombreApellidos} - ${t.numeroDocumento}</option>`;
    });
}

        // Registrar sede
        document.getElementById("sedesForm").addEventListener("submit", function(event) {
            event.preventDefault();
            let nombreSede = document.getElementById("nombreSede").value;
            let lineaSede = document.getElementById("lineaSede").value;

            // Validar campos obligatorios
            if (!nombreSede || !lineaSede) {
                Swal.fire("Error", "Todos los campos son obligatorios", "error");
                return;
            }

            // Verificar si ya existe una sede con el mismo nombre
            if (sedes.some(sede => sede.nombre === nombreSede)) {
                Swal.fire("Error", "Ya existe una sede con este nombre", "error");
                return;
            }

            // Registrar la sede
            let sede = { nombre: nombreSede, linea: lineaSede };
            sedes.push(sede);
            localStorage.setItem("sedes", JSON.stringify(sedes));
            mostrarSedes();
            Swal.fire("Éxito", "Sede registrada correctamente", "success");
            this.reset();
            cerrarModalSede();
        });

        document.addEventListener("DOMContentLoaded", mostrarSedes);

// Actualizar funciones existentes para incluir resumen
function actualizarResumen() {
  const totalHoras = registrosJornadas.reduce((sum, j) => sum + parseFloat(j.horasTrabajadas), 0);
  const totalExtras = registrosJornadas.reduce((sum, j) => sum + parseFloat(j.horasExtras), 0);
  const totalPago = registrosJornadas.reduce((sum, j) => sum + parseFloat(j.valorTotal), 0);

  document.getElementById('totalHoras').textContent = totalHoras.toFixed(2);
  document.getElementById('totalExtras').textContent = totalExtras.toFixed(2);
  document.getElementById('totalPago').textContent = `$${totalPago.toLocaleString()}`;
}

// Modificar función mostrarRegistrosJornadas
function mostrarRegistrosJornadas() {
  const tbody = document.getElementById("tablaRegistrosJornadas");
  tbody.innerHTML = "";
  
  registrosJornadas.forEach((jornada, index) => {
    const row = `
    <tr>
      <td>${jornada.nombre}</td>
      <td class="text-center">${jornada.fecha}</td>
      <td class="text-center">${parseFloat(jornada.horasTrabajadas).toFixed(2)}</td>
      <td class="text-center">
        <span class="tag-jornada ${jornada.tipoJornada}">${jornada.tipoJornada}</span>
      </td>
      <td class="text-center">
        <span class="estado-pendiente">Pendiente</span>
      </td>
      <td class="text-right">$${jornada.valorTotal.toLocaleString()}</td>
      <td class="text-center">
        <button class="btn-editar" onclick="editarJornada(${index})">
          <i class="fas fa-edit">Editar</i>
        </button>
        <button class="btn-eliminar" onclick="eliminarJornada(${index})">
          <i class="fas fa-trash">Eliminar</i>
        </button>
      </td>
    </tr>`;
    tbody.innerHTML += row;
  });

  actualizarResumen(); // Actualizar resumen al cambiar datos
}


// Llenar dropdown de ciudades al abrir el modal
function actualizarFiltroCiudades() {
    const ciudadesUnicas = [...new Set(sedes.map(sede => sede.ciudad))];
    const selectCiudad = document.getElementById("ciudadJornada");
    
    selectCiudad.innerHTML = '<option value="">Seleccione ciudad</option>';
    ciudadesUnicas.forEach(ciudad => {
        const option = document.createElement('option');
        option.value = ciudad;
        option.textContent = ciudad;
        selectCiudad.appendChild(option);
    });
}

// Actualizar clientes según ciudad seleccionada
function actualizarClientesPorCiudad() {
    const ciudad = document.getElementById("ciudadJornada").value;
    const selectSede = document.getElementById("sede");
    
    // Filtrar clientes únicos para la ciudad seleccionada
    const clientesEnCiudad = [...new Set(
        sedes.filter(s => s.ciudad === ciudad)
             .map(s => s.cliente)
    )];

    selectSede.innerHTML = '<option value="">Seleccione cliente</option>';
    clientesEnCiudad.forEach(cliente => {
        const option = document.createElement('option');
        option.value = cliente;
        option.textContent = cliente;
        selectSede.appendChild(option);
    });
}

// Modificar la función existente para abrir el modal
function abrirModalJornada() {
    actualizarFiltroCiudades(); // Llenar ciudades primero
    document.getElementById("modalJornadas").style.display = "flex";
}


console.log("Datos del trabajador:", trabajador);


// Función para cerrar el modal
function cerrarModalEPP() {
    document.getElementById("modalEPP").style.display = "none";
}

function exportarTrabajadoresExcel() {
    const datos = trabajadores.map(trabajador => ({
        "ID": trabajador.id || "",
        "Nombre": trabajador.nombreApellidos || "",
        "Documento": `${trabajador.tipoDocumento} - ${trabajador.numeroDocumento}`,
        "Fecha Nacimiento": trabajador.fechaNacimiento || "",
        "RH": trabajador.rh || "",
        "Género": trabajador.genero || "",
        "Ciudad": trabajador.ciudad || "",
        "Teléfono": trabajador.telefonoContacto || "",
        "EPS": trabajador.eps || "",
        "ARL": trabajador.arl || "",
        "Cargo": trabajador.cargo || "",
        "Tipo Cuenta": trabajador.tipoCuenta || "",  // <- Campo agregado
        "Banco": trabajador.banco || "",
        "Tipo Doc. Titular": trabajador.tipoDocumentoTitular || "",  // <- Campo corregido
        "Nombre Titular": trabajador.nombreTitular || "",  // <- Campo agregado
        "Doc. Titular": trabajador.numeroDocumentoTitular || "",  // <- Campo agregado
        "Número Cuenta": trabajador.numeroCuenta || ""  // <- Nombre corregido

    }));

    const hoja = XLSX.utils.json_to_sheet(datos);
    const libro = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(libro, hoja, "Trabajadores");
    XLSX.writeFile(libro, "base_trabajadores.xlsx");
}

    </script>
        
</body>
</html>
